<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 1.5.4">
  <title>&#160;&#160;&#160;&#160;&#160;&#160;Vilniaus Gedimino technikos universitetas</title>
  <link rel="stylesheet" href="https://asciidoclive.com/assets/asciidoctor.js/css/asciidoctor.css">
</head>

<body class="article">
  <div id="header">
    <h1>&#160;&#160;&#160;&#160;&#160;&#160;Vilniaus Gedimino technikos universitetas</h1>
  </div>
  <div id="content">
    <div class="sect1 text-center">
      <h2 id="_elektronikos_fakultetas">Elektronikos fakultetas</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="_kompiuterijos_ir_ry_i_technologij_katedra">Kompiuterijos ir ryšių technologijų katedra</h3>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_debes_kompiuterija">Debesų kompiuterija</h3>
          <div class="paragraph">
            <p>Modulis ELKRM17304</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1 text-center">
      <h2 id="_susipa_inimas_su_kubernetes_platforma">Susipažinimas su Kubernetes platforma</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>Laboratorinio darbo nr. 3 ataskaita</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph text-right">
          <p><strong>Atliko:</strong> TETfm-20 grupės magistrantas<br> Saulius Krasuckas<br>
            <strong>Tikrino:</strong> lekt. dr. Liudas Duoba</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="paragraph">
          <p>VILNIUS, 2022</p>
        </div>
        <div style="page-break-after: always;"></div>
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="sect3 text-center">
          <h4 id="_laboratorinis_darbas_nr_3">Laboratorinis darbas nr. 3</h4>

        </div>
      </div>
    </div>
    <div class="sect1 text-center">
      <h2 id="_susipa_inimas_su_kubernetes_platforma_2">Susipažinimas su Kubernetes platforma</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>&#160;</p>
        </div>
        <div class="sect2 text-center">
          <h3 id="_darbo_tikslas">Darbo tikslas</h3>
          <div class="ulist text-left">
            <ul>
              <li>
                <p>Išbandyti <code>Kubernetes</code> platformą.</p>
              </li>
              <li>
                <p>Atlikti pagrindinius veiksmus su <code>Kubernetes</code> resursais.</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect2 text-center">
          <h3 id="_darbo_eiga">Darbo eiga</h3>
          <div class="paragraph text-left">
            <p>Puslapyje <strong><a href="https://www.katacoda.com/courses/kubernetes">Learn Kubernetes using Interactive Browser-Based Labs | Katacoda</a></strong>              susikūriau prisijungimą pasinaudodamas "<em>Log In with Github</em>"
              metodu ir autorizuodamas savo akademinę GitHub paskyrą.</p>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_u_duotis_nr_1_strong_a_href_https_www_katacoda_com_courses_kubernetes_launch_single_node_cluster_launch_single_node_kubernetes_cluster_a_strong">Užduotis nr. 1: "<strong><a href="https://www.katacoda.com/courses/kubernetes/launch-single-node-cluster">Launch Single Node Kubernetes Cluster</a></strong>"</h3>
          <div class="sect3">
            <h4 id="__vadas">Įvadas</h4>
            <div class="paragraph">
              <p><em>Minikube</em>&#8201;&#8212;&#8201;įrankis pradėti naudotis Kubernetes
                lokaliai, bet produkcinio tinklo. Jis virtualioje mašinoje (VM) startuoja
                vienamazgį (angl. <em>single-node</em>) Kubernetes klasterį ir tinka
                asmeniniam kompiuteriui. Skirtas naudotojams, siekiantiems išmėginti
                Kubernetes ar net vykdyti kasdienį sistemų kūrimą Kubernetes pagrindu.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_1_1_strong_code_minikube_code_startas_strong">Žingsnis 1.1: <strong><code>Minikube</code> startas</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>patikrinu versiją:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ minikube version
minikube version: v1.8.1
commit: cbda04cf6bbe65e987ae52bb393c10099ab62014</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452640?autoplay=1">asciinema.org/a/452640</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>startuoju VM su <code>Kubernetes</code> klasteriu:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ minikube start --wait=false
* minikube v1.8.1 on Ubuntu 18.04
* Using the none driver based on user configuration
* Running on localhost (CPUs=2, Memory=2460MB, Disk=145651MB) ...
* OS release is Ubuntu 18.04.4 LTS
* Preparing Kubernetes v1.17.3 on Docker 19.03.6 ...
  - kubelet.resolv-conf=/run/systemd/resolve/resolv.conf
* Launching Kubernetes ...
* Enabling addons: default-storageclass, storage-provisioner
* Configuring local host environment ...
* Done! kubectl is now configured to use "minikube"</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452643?autoplay=1">asciinema.org/a/452643</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_1_2_strong_em_kubernetes_em_klasterio_informacija_strong">Žingsnis 1.2: <strong><em>Kubernetes</em> klasterio informacija</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>tikrinu klasterio būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl cluster-info
Kubernetes master is running at https://172.17.0.86:8443
KubeDNS is running at https://172.17.0.86:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452671?autoplay=1">asciinema.org/a/452671</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>klasterio mazgų sąrašas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get nodes
NAME       STATUS     ROLES    AGE   VERSION
minikube   NotReady   master   16s   v1.17.3

$ kubectl get nodes
NAME       STATUS   ROLES    AGE   VERSION
minikube   Ready    master   18s   v1.17.3</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452686?autoplay=1">asciinema.org/a/452686</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_1_3_strong_diegiame_konteiner_klasteryje_strong">Žingsnis 1.3: <strong>diegiame konteinerį klasteryje</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>konteinerio diegimas iš atvaizdo:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl create deployment first-deployment --image=katacoda/docker-http-server
deployment.apps/first-deployment created</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452688?autoplay=1">asciinema.org/a/452688</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikrinu diegimo būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get pods
NAME                               READY   STATUS              RESTARTS   AGE
first-deployment-666c48b44-92c2z   0/1     ContainerCreating   0          3s

$ kubectl get pods
NAME                               READY   STATUS              RESTARTS   AGE
first-deployment-666c48b44-92c2z   0/1     ContainerCreating   0          4s

$ kubectl get pods
NAME                               READY   STATUS    RESTARTS   AGE
first-deployment-666c48b44-92c2z   1/1     Running   0          5s</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452708?autoplay=1">asciinema.org/a/452708</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>paviešinu konteinerį tinkle:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl expose deployment first-deployment --port=80 --type=NodePort
service/first-deployment exposed</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452709?autoplay=1">asciinema.org/a/452709</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>susirandu alokuotą TCP-portą ir vykdome HTTP-užklausą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get svc first-deployment -o go-template='{{range.spec.ports}}{{if .nodePort}}{{.nodePort}}{{"\n"}}{{end}}{{end}}'
31900

$ export PORT=$(kubectl get svc first-deployment -o go-template='{{range.spec.ports}}{{if .nodePort}}{{.nodePort}}{{"\n"}}{{end}}{{end}}')

$ echo "Accessing host01:$PORT"
Accessing host01:31900

$ curl host01:$PORT
&lt;h1&gt;This request was processed by host: first-deployment-666c48b44-92c2z&lt;/h1&gt;</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452711?autoplay=1">asciinema.org/a/452711</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_1_4_strong_em_kubernetes_dashboard_em_s_saja_web_ui_strong">Žingsnis 1.4: <strong><em>Kubernetes Dashboard</em> sąsaja (web-UI)</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>įgalinu <em>Minicube</em> priedą <em>Dashboard</em>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ minikube addons enable dashboard
* The 'dashboard' addon is enabled</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452714?autoplay=1">asciinema.org/a/452714</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>diegiu <em>Kubernetes Dashboard</em> pagal duotą YAML šabloną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl apply -f /opt/kubernetes-dashboard.yaml
namespace/kubernetes-dashboard configured
service/kubernetes-dashboard-katacoda created</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452718?autoplay=1">asciinema.org/a/452718</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>patikrinu šablono turinį:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ ls -l /opt/kubernetes-dashboard.yaml
-rw-r--r-- 1 root root 588 Mar  8  2020 /opt/kubernetes-dashboard.yaml

$ cat /opt/kubernetes-dashboard.yaml
apiVersion: v1
kind: Namespace
metadata:
  labels:
    addonmanager.kubernetes.io/mode: Reconcile
    kubernetes.io/minikube-addons: dashboard
  name: kubernetes-dashboard
  selfLink: /api/v1/namespaces/kubernetes-dashboard
spec:
  finalizers:
  - kubernetes
status:
  phase: Active
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app: kubernetes-dashboard
  name: kubernetes-dashboard-katacoda
  namespace: kubernetes-dashboard
spec:
  ports:
  - port: 80
    protocol: TCP
    targetPort: 9090
    nodePort: 30000
  selector:
    k8s-app: kubernetes-dashboard
  type: NodePort</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>stebiu <em>Dashboard</em> konteinerių startą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get pods -n kubernetes-dashboard -w
NAME                                         READY   STATUS              RESTARTS   AGE
dashboard-metrics-scraper-7b64584c5c-7x46c   0/1     ContainerCreating   0          1s
kubernetes-dashboard-79d9cd965-7f5pb         0/1     ContainerCreating   0          1s
kubernetes-dashboard-79d9cd965-7f5pb         1/1     Running             0          1s
dashboard-metrics-scraper-7b64584c5c-7x46c   1/1     Running             0          2s
^C
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/452725?autoplay=1">asciinema.org/a/452725</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikrinu web-UI sąsają tiesiogiai: <br>
                    <a href="https://2886795274-30000-cykoria04.environments.katacoda.com/" class="bare">https://2886795274-30000-cykoria04.environments.katacoda.com/</a></p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>klasterio apžvalga:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149772492-a72b5b07-9c09-463d-885a-3c4b81b31ff5.png"
                              alt="149772492 a72b5b07 9c09 463d 885a 3c4b81b31ff5">
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>&#160;</p>
                        </div>
                      </li>
                      <li>
                        <p>vardų srities apkrovos apžvalga:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149772830-d20b2b96-3d10-432b-9d8a-78e34f04c4bc.png"
                              alt="149772830 d20b2b96 3d10 432b 9d8a 78e34f04c4bc">
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>&#160;</p>
                        </div>
                      </li>
                      <li>
                        <p>bandomojo diegimo būsena:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149774966-f3c803b3-7b9e-489d-9b82-a23e78d2c663.png"
                              alt="149774966 f3c803b3 7b9e 489d 9b82 a23e78d2c663">
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>&#160;</p>
                        </div>
                      </li>
                      <li>
                        <p>jo „ankšties“ būsena:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149775048-a056fe1e-126f-4371-a9f9-88859feb2f34.png"
                              alt="149775048 a056fe1e 126f 4371 a9f9 88859feb2f34">
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>&#160;</p>
                        </div>
                      </li>
                      <li>
                        <p>paslaugų būsena, apkrovos balansavimas:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149773732-aaf5f1c9-3c28-44e1-8fc6-05c5f44bf709.png"
                              alt="149773732 aaf5f1c9 3c28 44e1 8fc6 05c5f44bf709">
                          </div>
                        </div>
                        <hr>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149773955-ef7a3c7a-6826-4ca5-9723-f40e949fe007.png"
                              alt="149773955 ef7a3c7a 6826 4ca5 9723 f40e949fe007">
                          </div>
                        </div>
                        <hr>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149774143-436458fd-7075-48cd-bcd2-21c7f464f4ba.png"
                              alt="149774143 436458fd 7075 48cd bcd2 21c7f464f4ba">
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>&#160;</p>
                        </div>
                      </li>
                      <li>
                        <p>vardų srities konfigūracija ir talpinimas:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149774278-d7afe893-5549-47e7-a9fa-d3f51b425ab7.png"
                              alt="149774278 d7afe893 5549 47e7 a9fa d3f51b425ab7">
                          </div>
                        </div>
                        <hr>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/149774439-804af510-6baa-4663-8037-56476357ddc9.png"
                              alt="149774439 804af510 6baa 4663 8037 56476357ddc9">
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>&#160;</p>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_suvestin_nr_1">Suvestinė nr. 1:</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Panaudojau <code>minikube</code> bei <code>kubectl</code> komandas
                    (jų subkomandas) ir:</p>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>startavau vieno mazgo Kubernetes miniklasterį; <br> (atskiroje
                          VM, pasak gido)</p>
                      </li>
                      <li>
                        <p>patikrinau klasterio būseną: veikiantis;</p>
                      </li>
                      <li>
                        <p>sukūriau konteinerį pagal <code>katacoda/docker-http-server</code>                          atvaizdą; <br> (tik vaizdo įraše padariau klaidą įterpdamas
                          vieną papildomą raidę: <code>kataco<strong>n</strong>da</code>)</p>
                      </li>
                      <li>
                        <p>patikrinau diegimo „ankštį“: ji susikūrė konteinerį ir veikia;</p>
                      </li>
                      <li>
                        <p>paviešinau konteinerinę paslaugą tinkle atskiru <code>31900/TCP</code>                          portu;</p>
                      </li>
                      <li>
                        <p>prisijungiau šiuo portu su <code>curl</code> ir patikrinau
                          paslaugos būseną: veikia;</p>
                      </li>
                      <li>
                        <p>įdiegiau ir startavau <em>Minicube</em> priedą&#8201;&#8212;&#8201;Web
                          sąsają <em>Dashboard</em></p>
                      </li>
                      <li>
                        <p>bei patikrinau klasterio būseną joje naudodamasis savo naršykle.
                          <br> (Nuoroda Web prisijungimui pateikė pats <em>katacoda.com</em>                          gidas)</p>
                      </li>
                    </ol>
                  </div>
                </li>
                <li>
                  <p><em>Dashboard</em> interfeisas <em>Overview</em> skiltyje pasirenka
                    <code>default</code> vardų sritį (<em>Namespace</em>):</p>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>joje nematyti savo paties „ankščių“ (<em>Pods</em>): <br>
                          <code>kubernetes-dashboard-79d9cd965-7f5pb</code>, <br>
                          <code>dashboard-metrics-scraper-7b64584c5c-7x46c</code></p>
                      </li>
                      <li>
                        <p>pastarosios tampa matomos pasirinkus <code>All namespaces</code>                          vardų sritį.</p>
                      </li>
                    </ol>
                  </div>
                </li>
              </ul>
            </div>
            <div style="page-break-after: always;"></div>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_u_duotis_nr_2_strong_a_href_https_www_katacoda_com_courses_kubernetes_kubectl_run_containers_deploy_containers_using_kubectl_a_strong">Užduotis nr. 2: "<strong><a href="https://www.katacoda.com/courses/kubernetes/kubectl-run-containers">Deploy Containers Using Kubectl</a></strong>"</h3>
          <div class="sect3">
            <h4 id="__vadas_2">Įvadas</h4>
            <div class="paragraph">
              <p>Mokinsimės <em>Kubectl</em> pagalba kurti ir startuoti įdiegimus, replikavimo
                valdiklius ir viešinti juos kaip paslaugas. Čia nenaudosime YAML
                apibrėžčių. Šis būdas klasteryje įgalina sparčiai pradėti konteinerius
                kūrimą ir jų vykdymą.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_2_1_strong_startuojame_kubernetes_klaster_strong">Žingsnis 2.1: <strong>startuojame Kubernetes klasterį</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>startuojame klasterį ir įgaliname Kubectl CLI:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ minikube start --wait=false
* minikube v1.8.1 on Ubuntu 18.04
* Using the none driver based on user configuration

* Running on localhost (CPUs=2, Memory=2460MB, Disk=145651MB) ...
* OS release is Ubuntu 18.04.4 LTS

* Preparing Kubernetes v1.17.3 on Docker 19.03.6 ...
  - kubelet.resolv-conf=/run/systemd/resolve/resolv.conf
* Launching Kubernetes ...

* Enabling addons: default-storageclass, storage-provisioner
* Configuring local host environment ...
* Done! kubectl is now configured to use "minikube"
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462314?autoplay=1">asciinema.org/a/462314</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>patikriname mazgo būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get nodes
NAME       STATUS     ROLES    AGE   VERSION
minikube   NotReady   master   15s   v1.17.3
$
$ kubectl get nodes
NAME       STATUS   ROLES    AGE   VERSION
minikube   Ready    master   23s   v1.17.3
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462317?autoplay=1">asciinema.org/a/462317</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_2_2_strong_vykdome_code_kubectl_code_su_code_run_code_strong">Žingsnis 2.2: <strong>vykdome <code>kubectl</code> su <code>run</code></strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>sukuriame įdiegimą ir startuojame jo „ankštis“ bei konteinerius:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl run http --image=katacoda/docker-http-server:latest --replicas=1
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/http created
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462319?autoplay=1">asciinema.org/a/462319</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikriname įdiegimų būsenas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get deployments
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
http   0/1     1            0           35s
$
$ kubectl get deployments
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
http   0/1     1            0           39s
$
$ kubectl get deployments
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
http   0/1     1            0           42s
$
$ kubectl get deployments
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
http   0/1     1            0           47s
$
$ kubectl get deployments
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
http   1/1     1            1           55s
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462320?autoplay=1">asciinema.org/a/462320</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikriname išsamų įdiegimo aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl describe deployment http
Name:                   http
Namespace:              default
CreationTimestamp:      Mon, 17 Jan 2022 18:02:36 +0000
Labels:                 run=http
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               run=http
Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  run=http
  Containers:
   http:
    Image:        katacoda/docker-http-server:latest
    Port:         &lt;none&gt;
    Host Port:    &lt;none&gt;
    Environment:  &lt;none&gt;
    Mounts:       &lt;none&gt;
  Volumes:        &lt;none&gt;
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   http-774bb756bb (1/1 replicas created)
Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  76s   deployment-controller  Scaled up replica set http-774bb756bb to 1
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462321?autoplay=1">asciinema.org/a/462321</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_2_3_strong_vykdome_code_kubectl_code_su_code_expose_code_strong">Žingsnis 2.3: <strong>vykdome <code>kubectl</code> su <code>expose</code></strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>sukuriame paslaugą paviešindami konkretų konteinerio portą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl expose deployment http --external-ip="172.17.0.11" --port=8000 --target-port=80
service/http exposed
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462325?autoplay=1">asciinema.org/a/462325</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>patikriname paslaugos veikimą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ curl http://172.17.0.11:8000
&lt;h1&gt;This request was processed by host: http-774bb756bb-bbvm9&lt;/h1&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462326?autoplay=1">asciinema.org/a/462326</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_2_4_strong_vykdome_code_kubectl_code_su_code_run_code_code_expose_code_i_kart_strong">Žingsnis 2.4: <strong>vykdome <code>kubectl</code> su <code>run</code>+<code>expose</code> iškart</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>sukuriame naują įdiegimą ir paviešiname naują paslaugą kitu portu
                    vienu ypu, kitu būdu:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl run httpexposed --image=katacoda/docker-http-server:latest --replicas=1 --port=80 --hostport=8001
kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.
deployment.apps/httpexposed created
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462331?autoplay=1">asciinema.org/a/462331</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>patikriname naujos paslaugos veikimą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ curl http://172.17.0.11:8001
&lt;h1&gt;This request was processed by host: httpexposed-68cb8c8d4-d9b6w&lt;/h1&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462333?autoplay=1">asciinema.org/a/462333</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikriname, ar naujas portas tikrai neatsirado paslaugų sąraše:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get svc
NAME         TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
http         ClusterIP   10.96.205.142   172.17.0.11   8000/TCP   19m
kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP    39m
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462336?autoplay=1">asciinema.org/a/462336</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikriname, ar naujas portas atsirado tos pačios „ankšties“ tinkliniame
                    konteineryje <code>pause</code>: <br> (per <em>Docker Port Mapping</em>                    mechanizmą)</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ docker ps | grep httpexposed
5945f9a4fa9b        katacoda/docker-http-server   "/app"                   10 minutes ago      Up 10 minutes                              k8s_httpexposed_httpexposed-68cb8c8d4-d9b6w_default_f2718b05-501c-4158-8d8e-0e4a62e99db9_0
6cc613c77542        k8s.gcr.io/pause:3.1          "/pause"                 10 minutes ago      Up 10 minutes       0.0.0.0:8001-&gt;80/tcp   k8s_POD_httpexposed-68cb8c8d4-d9b6w_default_f2718b05-501c-4158-8d8e-0e4a62e99db9_0
$
$ # OK
$
$ docker ps | wc -l
21</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462338?autoplay=1">asciinema.org/a/462338</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_2_5_strong_dauginame_konteinerius_strong">Žingsnis 2.5: <strong>dauginame konteinerius</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>pakeliame „ankščių“ skaičių iki 3:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl scale --replicas=3 deployment http
deployment.apps/http scaled
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462340?autoplay=1">asciinema.org/a/462340</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikriname „ankščių“ būsenas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
http-774bb756bb-bbvm9         1/1     Running   0          43m
httpexposed-68cb8c8d4-d9b6w   1/1     Running   0          18m
$
$ kubectl get pods
NAME                          READY   STATUS    RESTARTS   AGE
http-774bb756bb-bbvm9         1/1     Running   0          51m
http-774bb756bb-jcbgf         1/1     Running   0          7m50s
http-774bb756bb-qvqkc         1/1     Running   0          7m50s
httpexposed-68cb8c8d4-d9b6w   1/1     Running   0          26m</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462341?autoplay=1">asciinema.org/a/462341</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikriname, ar „ankštys“ pateko į apkrovos balansavimą šiai paslaugai:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl describe svc http
Name:              http
Namespace:         default
Labels:            run=http
Annotations:       &lt;none&gt;
Selector:          run=http
Type:              ClusterIP
IP:                10.96.205.142
External IPs:      172.17.0.11
Port:              &lt;unset&gt;  8000/TCP
TargetPort:        80/TCP
Endpoints:         172.18.0.4:80,172.18.0.6:80,172.18.0.7:80
Session Affinity:  None
Events:            &lt;none&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462343?autoplay=1">asciinema.org/a/462343</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>atliekame kelias tos pačios paslaugos užklausas iš eilės:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ curl http://172.17.0.11:8000
&lt;h1&gt;This request was processed by host: http-774bb756bb-bbvm9&lt;/h1&gt;
$
$ curl http://172.17.0.11:8000
&lt;h1&gt;This request was processed by host: http-774bb756bb-qvqkc&lt;/h1&gt;
$
$ # OK, kitas hosto ID
$
$ curl http://172.17.0.11:8000
&lt;h1&gt;This request was processed by host: http-774bb756bb-bbvm9&lt;/h1&gt;
$
$ curl http://172.17.0.11:8000
&lt;h1&gt;This request was processed by host: http-774bb756bb-jcbgf&lt;/h1&gt;
$
$ # dar vienas naujas hosto ID
$
$ curl http://172.17.0.11:8000
&lt;h1&gt;This request was processed by host: http-774bb756bb-qvqkc&lt;/h1&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462344?autoplay=1">asciinema.org/a/462344</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_suvestin_nr_2">Suvestinė nr. 2:</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Panaudojau <code>kubectl</code> komandas (ir subkomandas), ir:</p>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>startavau klasterį, įgalinau Kubectl CLI;</p>
                      </li>
                      <li>
                        <p>patikrinau mazgo būseną: veikia;</p>
                      </li>
                      <li>
                        <p>sukūriau įdiegimą su viena replika komandos <code>kubectl run &#8230;&#8203;</code>                          pagalba;</p>
                      </li>
                      <li>
                        <p>patikrinau HTTP paslaugos įdiegimo būseną: pradėjo veikti;</p>
                      </li>
                      <li>
                        <p>patikrinau išsamų įdiegimo aprašą: atitinka planą;</p>
                      </li>
                      <li>
                        <p>sukūriau paslaugą paviešindamas HTTP portą kaip <code>8000/TCP</code>;</p>
                      </li>
                      <li>
                        <p>patikrinau paslaugos veikimą: atsiliepia be klaidų;</p>
                      </li>
                      <li>
                        <p>sukūriau naują HTTP paslaugos diegimą kitu būdu&#8201;&#8212;&#8201;iškart
                          viešinant paslaugos portą;</p>
                      </li>
                      <li>
                        <p>šįkart HTTP portas yra <code>8001/TCP</code>;</p>
                      </li>
                      <li>
                        <p>patikrinau paslaugos veikimą: atsiliepia irgi;</p>
                      </li>
                      <li>
                        <p>patikrinau paslaugų sąrašą: naujojo porto nematyti;</p>
                      </li>
                      <li>
                        <p>patikrinau konteinerių sąrašą su Docker komanda: <br> naujasis
                          portas priklauso "k8s.gcr.io/pause" tipo konteineriui;</p>
                      </li>
                      <li>
                        <p>pakėliau pirmosios paslaugos „ankšties“ kopijų skaičių nuo
                          1 iki 3;</p>
                      </li>
                      <li>
                        <p>tikrinau jų būsenas ir sulaukiau, kol startuos dvi papildonos;</p>
                      </li>
                      <li>
                        <p>įsitikinau, kad visų trijų paslaugos „ankščių“ HTTP-portai
                          pateko į apkrovos balansavimą;</p>
                      </li>
                      <li>
                        <p>atlikau šiai paslaugai keletą užklausų iš eilės: <br> įsitikinau,
                          kad atsako skirtingas Host ID (iš trijų galimų);</p>
                      </li>
                      <li>
                        <p>tyrimas baigtas.</p>
                      </li>
                    </ol>
                  </div>
                </li>
                <li>
                  <p><code>kubectl run --image= &#8230;&#8203;</code> komanda pyksta
                    dėl <em>Deprecated</em> opcijos <code>--generator</code>, nors
                    aš tokios nenaudojau. <br> Ir rekomenduoja naudoti vieną iš dviejų
                    kitokių komandų.</p>
                  <div class="paragraph">
                    <p>&#8658; Turbūt verta parašyti <code>katacoda</code> treniruoklio
                      autoriams, kad atėjo metas atnaujinti instrukcijas. :)</p>
                  </div>
                </li>
                <li>
                  <p>Tikėtina, kad <em>Docker Port Mapping</em> mechanizmas veikia būtent
                    taip minima punkte nr. 12. <br> Tačiau nežinau, kaip įsitikinti
                    garantuotai, kad jis čia panaudotas.</p>
                </li>
                <li>
                  <p>Pasigedau veiksmo, kuriame būtume kurę replikavimo valdiklius,
                    kaip žadėta užduoties aprašyme.</p>
                </li>
              </ul>
            </div>
            <div style="page-break-after: always;"></div>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_u_duotis_nr_3_strong_a_href_https_www_katacoda_com_courses_kubernetes_creating_kubernetes_yaml_definitions_deploy_containers_using_yaml_a_strong">Užduotis nr. 3: "<strong><a href="https://www.katacoda.com/courses/kubernetes/creating-kubernetes-yaml-definitions">Deploy Containers Using YAML</a></strong>"</h3>
          <div class="sect3">
            <h4 id="__vadas_3">Įvadas</h4>
            <div class="paragraph">
              <p>Mokinsimės Kubectl pagalba kurti ir startuoti įdiegimus, replikavimo
                valdiklius ir viešinti juos kaip paslaugas šįkart <em>jau</em> pasinaudojant
                YAML apibrėžtimis (YAML formatu).</p>
            </div>
            <div class="paragraph">
              <p>YAML apibrėžtimis aprašomi Kubernetes objektai, paskirti įdiegimams.
                Taip pat bus ir galimybė keičiantis konfigūracijai šiuos objektus
                atnaujinti bei perdiegti į klasterį iš naujo.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_3_1_strong_diegimo_k_rimas_strong">Žingsnis 3.1: <strong>įdiegimo kūrimas</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>automatinis klasterio startas su <em>Shell</em>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>Your Interactive Bash Terminal. A safe place to learn and execute commands.

$ minikube start --wait=false
* minikube v1.8.1 on Ubuntu 18.04
* Using the none driver based on user configuration
* Running on localhost (CPUs=2, Memory=2460MB, Disk=145651MB) ...
* OS release is Ubuntu 18.04.4 LTS
* Preparing Kubernetes v1.17.3 on Docker 19.03.6 ...
  - kubelet.resolv-conf=/run/systemd/resolve/resolv.conf
* Launching Kubernetes ...
* Enabling addons: default-storageclass, storage-provisioner
* Configuring local host environment ...
* Done! kubectl is now configured to use "minikube"
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>įkeliu YAML šabloną <code>deployment.yaml</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ ls -l
total 8
-rw-r--r-- 1 root root  335 Jan 17 22:37 deployment.yaml
drwxr-xr-x 2 root root 4096 Mar  1  2020 Desktop

$ cat deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: webapp1
spec:
  replicas: 1
  selector:
    matchLabels:
      app: webapp1
  template:
    metadata:
      labels:
        app: webapp1
    spec:
      containers:
      - name: webapp1
        image: katacoda/docker-http-server:latest
        ports:
        - containerPort: 80
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462387?autoplay=1">asciinema.org/a/462387</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>į klasterį diegiu aplikaciją <code>webapp1</code> iš Doker atvaizdo
                    <code>katacoda/docker-http-server:latest</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl create -f deployment.yaml
deployment.apps/webapp1 created
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462388?autoplay=1">asciinema.org/a/462388</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>peržiūriu įdiegimų sąrašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get deployment
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
webapp1   1/1     1            1           4m37s
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462389?autoplay=1">asciinema.org/a/462389</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>peržiūriu <code>webapp1</code> įdiegimo aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl describe deployment webapp1
Name:                   webapp1
Namespace:              default
CreationTimestamp:      Mon, 17 Jan 2022 22:45:45 +0000
Labels:                 &lt;none&gt;
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               app=webapp1
Replicas:               1 desired | 1 updated | 1 total | 1 available | 0 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  25% max unavailable, 25% max surge
Pod Template:
  Labels:  app=webapp1
  Containers:
   webapp1:
    Image:        katacoda/docker-http-server:latest
    Port:         80/TCP
    Host Port:    0/TCP
    Environment:  &lt;none&gt;
    Mounts:       &lt;none&gt;
  Volumes:        &lt;none&gt;
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  &lt;none&gt;
NewReplicaSet:   webapp1-6b54fb89d9 (1/1 replicas created)
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  6m55s  deployment-controller  Scaled up replica set webapp1-6b54fb89d9 to 1
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462390?autoplay=1">asciinema.org/a/462390</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_3_2_strong_paslaugos_k_rimas_strong">Žingsnis 3.2: <strong>paslaugos kūrimas</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>įkeliu YAML šabloną <code>service.yaml</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ ls -l
total 12
-rw-r--r-- 1 root root  335 Jan 17 22:37 deployment.yaml
drwxr-xr-x 2 root root 4096 Mar  1  2020 Desktop
-rw-r--r-- 1 root root  180 Jan 17 22:57 service.yaml

$ cat service.yaml
apiVersion: v1
kind: Service
metadata:
  name: webapp1-svc
  labels:
    app: webapp1
spec:
  type: NodePort
  ports:
  - port: 80
    nodePort: 30080
  selector:
    app: webapp1
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462391?autoplay=1">asciinema.org/a/462391</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>įdiegiu paslaugą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl create -f service.yaml
service/webapp1-svc created
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462392?autoplay=1">asciinema.org/a/462392</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>peržiūriu įdiegtų paslaugų sąrašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get svc
NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
kubernetes    ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        28m
webapp1-svc   NodePort    10.105.23.172   &lt;none&gt;        80:30080/TCP   100s
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462393?autoplay=1">asciinema.org/a/462393</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>peržiūriu paslaugos <code>webapp1-svc</code> aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl describe svc webapp1-svc
Name:                     webapp1-svc
Namespace:                default
Labels:                   app=webapp1
Annotations:              &lt;none&gt;
Selector:                 app=webapp1
Type:                     NodePort
IP:                       10.105.23.172
Port:                     &lt;unset&gt;  80/TCP
TargetPort:               80/TCP
NodePort:                 &lt;unset&gt;  30080/TCP
Endpoints:                172.18.0.4:80
Session Affinity:         None
External Traffic Policy:  Cluster
Events:                   &lt;none&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462397?autoplay=1">asciinema.org/a/462397</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikrinu paslaugos veikimą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462398?autoplay=1">asciinema.org/a/462398</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_3_3_strong_diegimo_dauginimas_strong">Žingsnis 3.3: <strong>įdiegimo dauginimas</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>replikų (egzempliorių) skaičių YAML šablone <code>deployment.yaml</code>                    pakeliu iki 4:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ cp -v deployment.yaml deployment.yaml.OLD
'deployment.yaml' -&gt; 'deployment.yaml.OLD'

$ vim deployment.yaml

$ ls -l
total 16
-rw-r--r-- 1 root root  335 Jan 17 23:15 deployment.yaml
-rw-r--r-- 1 root root  335 Jan 17 23:14 deployment.yaml.OLD
drwxr-xr-x 2 root root 4096 Mar  1  2020 Desktop
-rw-r--r-- 1 root root  180 Jan 17 22:57 service.yaml

$ diff -u deployment.yaml.OLD deployment.yaml | colordiff
--- deployment.yaml.OLD 2022-01-17 23:14:54.436000000 +0000
+++ deployment.yaml     2022-01-17 23:15:16.648000000 +0000
@@ -3,7 +3,7 @@
 metadata:
   name: webapp1
 spec:
-  replicas: 1
+  replicas: 4
   selector:
     matchLabels:
       app: webapp1
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462399?autoplay=1">asciinema.org/a/462399</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>padauginu veikiančių replikų (egzempliorių) skaičių:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl apply -f deployment.yaml
Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
deployment.apps/webapp1 configured
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462400?autoplay=1">asciinema.org/a/462400</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikrinu įdiegimo / klasterio būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get deployment
NAME      READY   UP-TO-DATE   AVAILABLE   AGE
webapp1   4/4     4            4           36m
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462402?autoplay=1">asciinema.org/a/462402</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikrinu naujų „ankščių“ būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ kubectl get pods
NAME                       READY   STATUS    RESTARTS   AGE
webapp1-6b54fb89d9-27g4g   1/1     Running   0          7m50s
webapp1-6b54fb89d9-2v7vh   1/1     Running   0          7m50s
webapp1-6b54fb89d9-p8lck   1/1     Running   0          7m50s
webapp1-6b54fb89d9-qz98l   1/1     Running   0          40m
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462405?autoplay=1">asciinema.org/a/462405</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
                <li>
                  <p>tikrinu užklausas į paslaugą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-2v7vh&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-27g4g&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-2v7vh&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-qz98l&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-27g4g&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-27g4g&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-p8lck&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-27g4g&lt;/h1&gt;
$
$ curl host01:30080
&lt;h1&gt;This request was processed by host: webapp1-6b54fb89d9-p8lck&lt;/h1&gt;
$</pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p><a href="https://asciinema.org/a/462404?autoplay=1">asciinema.org/a/462404</a></p>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_suvestin_nr_3">Suvestinė nr. 3:</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Įvykdžiau diegimą pagal YAML šabloną (arba YAML apibrėžtį, angl.
                    <em>definition</em>):</p>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>gavau Shell su veikiančiu K8s miniklasteriu;</p>
                      </li>
                      <li>
                        <p>įkėliau <code>deployment.yaml</code> šabloną;</p>
                      </li>
                      <li>
                        <p>pagal jį įdiegiau aplikaciją <code>webapp1</code> iš Docker
                          atvaizdo <code>katacoda/docker-http-server</code>;</p>
                      </li>
                      <li>
                        <p>įsitikinau, kad įdiegimas pavyko;</p>
                      </li>
                      <li>
                        <p>peržiūrėjau jo aprašą, Host Port nenurodytas (<code>0/TCP</code>);</p>
                      </li>
                      <li>
                        <p>įkėliau <code>service.yaml</code> šabloną;</p>
                      </li>
                      <li>
                        <p>pagal jį įdiegiau HTTP paslaugą <code>webapp1-svc</code>;</p>
                      </li>
                      <li>
                        <p>įsitikinau, kad HTTP paslauga sukonfigūruota;</p>
                      </li>
                      <li>
                        <p>peržiūrėjau jos aprašą, <code>NodePort</code> prievadui priskirta
                          <code>30080/TCP</code> reikšmė;</p>
                      </li>
                      <li>
                        <p>patikrinau paslaugos veikimą: ta pati „ankštis“ atsako į
                          visas užklausas iš eilės;</p>
                      </li>
                      <li>
                        <p>padidinau replikų skaičių šablone <code>deployment.yaml</code>                          iki 4;</p>
                      </li>
                      <li>
                        <p>pritaikiau šabloną klasteriui su <code>kubectl apply</code>                          komanda;</p>
                      </li>
                      <li>
                        <p>patikrinau įdiegimo ir „ankščių“ būseną: skaičius pakilo
                          iki 4;</p>
                      </li>
                      <li>
                        <p>patikrinau paslaugos veikimą: į užklausas atsako jau 4 skirtingos
                          „ankštys“;</p>
                      </li>
                      <li>
                        <p>patikrinau paslaugos aprašą: yra visi 4 <em>Endpoints</em>                          (iš jų vienas neišvestas dėl teksto trumpumo); <br> (šito
                          ataskaitoje neiliustravau)</p>
                      </li>
                      <li>
                        <p>tyrimas baigtas.</p>
                      </li>
                    </ol>
                  </div>
                </li>
                <li>
                  <p>Naudojant YAML failus <strong>tampa neaišku</strong>:</p>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>kodėl atsiranda <code>app</code> raktažodis ? (Panašu, kad
                          vietoj anksčiau naudoto <code>run</code>)</p>
                      </li>
                      <li>
                        <p>ką aprašo <code>spec.template</code> ir kas bus, jei <strong>ne</strong>nurodysiu
                          <code>spec.template.metadata.labels.app</code> ? (Kai jau
                          tas pat nurodyta pas <code>spec.selector.app</code>)</p>
                      </li>
                      <li>
                        <p>kodėl įdiegimo apraše vardą <code>webapp1</code> reikia nurodyti
                          net 4x:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p><code>spec.metadata.name</code> ?</p>
                            </li>
                            <li>
                              <p><code>spec.selector.matchLabels.app</code> ?</p>
                            </li>
                            <li>
                              <p><code>spec.template.metadata.labels.app</code> ?</p>
                            </li>
                            <li>
                              <p><code>spec.template.spec.containers.name</code> ?</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li>
                        <p>kodėl TCP portą <code>80</code> reikia nurodyti tiek įdiegimui
                          (<code>spec.template.spec.containers.ports</code>), tiek
                          paslaugai (<code>spec.ports.port</code>), kai per CLI pakakdavo
                          nurodyti tik vieną sykį ?</p>
                      </li>
                      <li>
                        <p>ar paslaugos <code>spec.selector.app</code> nurodo įdiegimo
                          konteinerį, ar įdiegimo „ankštį“ (galvojant ne YAML scenarijaus
                          sąvokomis) ?</p>
                      </li>
                      <li>
                        <p>Išvada: YAML šablonai įneša painavios į anksčiau susidarytą
                          pradinį supratimą apie K8s.</p>
                      </li>
                    </ol>
                  </div>
                </li>
                <li>
                  <p>Komanda <code>kubectl apply -f &#8230;&#8203;</code> pyksta: <br>
                    <code>Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply</code>                    <br></p>
                  <div class="paragraph">
                    <p>&#8658; Galbūt irgi vertėtų pranešti treniruoklio autoriams (dėl
                      instrukcijų patikslinimo).</p>
                  </div>
                </li>
              </ul>
            </div>
            <div style="page-break-after: always;"></div>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_u_duotis_nr_4_strong_a_href_https_www_katacoda_com_courses_kubernetes_guestbook_deploy_guestbook_example_on_kubernetes_a_strong">Užduotis nr. 4: "<strong><a href="https://www.katacoda.com/courses/kubernetes/guestbook">Deploy Guestbook example on Kubernetes</a></strong>"</h3>
          <div class="sect3">
            <h4 id="__vadas_4">Įvadas</h4>
            <div class="paragraph">
              <p>Čia mokinsimės su Kubernetes ir Docker pagalba startuoti paprastą,
                bet daugiapakopę Web aplikaciją. Siūlomos „Svečių knygos“ aplikacijos
                pavyzdys išsaugos puslapio svečių žinutes <em>Redis</em> duomenų
                bazėje (DB) kviesdamas JavaScript API.
                <em>Redis</em> DB susideda iš <em>masterio</em> (duomenų talpinimui)
                ir rinkinio iš replikuotų Redis <em>tarnų</em>.</p>
            </div>
            <div class="paragraph">
              <p>Numatoma aprėpti tokias esmines sąvokas:</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>„ankštys“</p>
                </li>
                <li>
                  <p>replikavimo valdikliai</p>
                </li>
                <li>
                  <p>paslaugos</p>
                </li>
                <li>
                  <p><em>NodePort</em> prievadai</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Jos sudaro <em>Kubernetes</em> pagrindą.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_1_strong_klasterio_startavimas_strong">Žingsnis 4.1: <strong>klasterio startavimas</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p><em>Shell</em> ir automatinis vienamazgio klasterio startas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>Your Interactive Bash Terminal. A safe place to learn and execute commands.

controlplane $ mkdir -p /root/tutorial; cd /root/tutorial; launch.sh
Waiting for Kubernetes to start...
Kubernetes started
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu klasterio būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl cluster-info
Kubernetes master is running at https://172.17.0.35:6443
KubeDNS is running at https://172.17.0.35:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.

controlplane $ kubectl get nodes
NAME           STATUS     ROLES    AGE   VERSION
controlplane   NotReady   master   19s   v1.14.0

controlplane $ kubectl get nodes
NAME           STATUS   ROLES    AGE    VERSION
controlplane   Ready    master   2m6s   v1.14.0
node01         Ready    &lt;none&gt;   79s    v1.14.0
controlplane $</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_2_strong_redis_em_master_em_valdiklis_strong">Žingsnis 4.2: <strong>Redis <em>master</em> valdiklis</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>peržiūriu YAML aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ cat redis-master-controller.yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: redis-master
  labels:
    name: redis-master
spec:
  replicas: 1
  selector:
    name: redis-master
  template:
    metadata:
      labels:
        name: redis-master
    spec:
      containers:
      - name: master
        image: redis:3.0.7-alpine
        ports:
        - containerPort: 6379
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>sukuriu ir startuoju Redis <em>masterio</em> replikacinį valdiklį:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl create -f redis-master-controller.yaml
replicationcontroller/redis-master created
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu replikacinių valdiklių būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get rc
NAME           DESIRED   CURRENT   READY   AGE
redis-master   1         1         0       5s

controlplane $ kubectl get rc
NAME           DESIRED   CURRENT   READY   AGE
redis-master   1         1         1       18s
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu „ankščių“ / konteinerių būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get pods
NAME                 READY   STATUS    RESTARTS   AGE
redis-master-bv75w   1/1     Running   0          4m1s
controlplane $</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_3_strong_redis_em_master_em_paslauga_strong">Žingsnis 4.3: <strong>Redis <em>master</em> paslauga</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>peržiūriu YAML aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ cat redis-master-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis-master
  labels:
    name: redis-master
spec:
  ports:
    # the port that this service should serve on
  - port: 6379
    targetPort: 6379
  selector:
    name: redis-master
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>sukuriu ir startuoju Redis <em>masterio</em> paslaugą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl create -f redis-master-service.yaml
service/redis-master created
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu paslaugos būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get services
NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
kubernetes     ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP    6m2s
redis-master   ClusterIP   10.98.222.56   &lt;none&gt;        6379/TCP   4s
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>peržiūriu Redis <em>masterio</em> paslaugos aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl describe services redis-master
Name:              redis-master
Namespace:         default
Labels:            name=redis-master
Annotations:       &lt;none&gt;
Selector:          name=redis-master
Type:              ClusterIP
IP:                10.98.222.56
Port:              &lt;unset&gt;  6379/TCP
TargetPort:        6379/TCP
Endpoints:         10.88.0.5:6379
Session Affinity:  None
Events:            &lt;none&gt;
controlplane $</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_4_strong_redis_em_tarn_em_valdiklis_strong">Žingsnis 4.4: <strong>Redis <em>tarnų</em> valdiklis</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>peržiūriu YAML aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ cat redis-slave-controller.yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: redis-slave
  labels:
    name: redis-slave
spec:
  replicas: 2
  selector:
    name: redis-slave
  template:
    metadata:
      labels:
        name: redis-slave
    spec:
      containers:
      - name: worker
        image: gcr.io/google_samples/gb-redisslave:v1
        env:
        - name: GET_HOSTS_FROM
          value: dns
          # If your cluster config does not include a dns service, then to
          # instead access an environment variable to find the master
          # service's host, comment out the 'value: dns' line above, and
          # uncomment the line below.
          # value: env
        ports:
        - containerPort: 6379
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>sukuriu ir startuoju Redis <em>tarnų</em> replikacinį valdiklį:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl create -f redis-slave-controller.yaml
replicationcontroller/redis-slave created
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu replikacinių valdiklių būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get rc
NAME           DESIRED   CURRENT   READY   AGE
redis-master   1         1         1       6m3s
redis-slave    2         2         0       3s

controlplane $ kubectl get rc
NAME           DESIRED   CURRENT   READY   AGE
redis-master   1         1         1       6m5s
redis-slave    2         2         2       5s
controlplane $</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_5_strong_redis_em_tarn_em_paslauga_strong">Žingsnis 4.5: <strong>Redis <em>tarnų</em> paslauga</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>peržiūriu YAML aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ cat redis-slave-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: redis-slave
  labels:
    name: redis-slave
spec:
  ports:
    # the port that this service should serve on
  - port: 6379
  selector:
    name: redis-slave
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>sukuriu ir startuoju Redis <em>tarnų</em> paslaugą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl create -f redis-slave-service.yaml
service/redis-slave created
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu paslaugos būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get services
NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
kubernetes     ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP    8m10s
redis-master   ClusterIP   10.98.222.56   &lt;none&gt;        6379/TCP   2m12s
redis-slave    ClusterIP   10.98.98.227   &lt;none&gt;        6379/TCP   1s
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>patikrinu ir „ankščių“ būsenas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get pods
NAME                 READY   STATUS    RESTARTS   AGE
redis-master-bv75w   1/1     Running   0          7m23s
redis-slave-bfzm9    1/1     Running   0          83s
redis-slave-f5f9f    1/1     Running   0          83s
controlplane $</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_6_strong_frontendas_replikacinis_valdiklis_ir_jo_ank_tys_strong">Žingsnis 4.6: <strong>Frontendas&#8201;&#8212;&#8201;replikacinis valdiklis ir jo „ankštys“</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>peržiūriu YAML aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ cat frontend-controller.yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: frontend
  labels:
    name: frontend
spec:
  replicas: 3
  selector:
    name: frontend
  template:
    metadata:
      labels:
        name: frontend
    spec:
      containers:
      - name: php-redis
        image: gcr.io/google_samples/gb-frontend:v3
        env:
        - name: GET_HOSTS_FROM
          value: dns
          # If your cluster config does not include a dns service, then to
          # instead access environment variables to find service host
          # info, comment out the 'value: dns' line above, and uncomment the
          # line below.
          # value: env
        ports:
        - containerPort: 80
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>sukuriu ir startuoju replikacinį valdiklį pagal <code>gcr.io/google_samples/gb-frontend</code>                    atvaizdą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl create -f frontend-controller.yaml
replicationcontroller/frontend created
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu replikacinių valdiklių būsenas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get rc
NAME           DESIRED   CURRENT   READY   AGE
frontend       3         3         3       88s
redis-master   1         1         1       12m
redis-slave    2         2         2       6m53s
controlplane $ kubectl get pods</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu „ankščių“ būsenas:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get pods
NAME                 READY   STATUS    RESTARTS   AGE
frontend-ctpql       1/1     Running   0          93s
frontend-dwkqh       1/1     Running   0          93s
frontend-g998c       1/1     Running   0          93s
redis-master-bv75w   1/1     Running   0          12m
redis-slave-bfzm9    1/1     Running   0          6m58s
redis-slave-f5f9f    1/1     Running   0          6m58s</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_7_strong_sve_i_knygos_frontendin_paslauga_strong">Žingsnis 4.7: <strong>„Svečių knygos“ frontendinė paslauga</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>peržiūriu YAML aprašą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ cat frontend-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: frontend
  labels:
    name: frontend
spec:
  # if your cluster supports it, uncomment the following to automatically create
  # an external load-balanced IP for the frontend service.
  # type: LoadBalancer
  type: NodePort
  ports:
    # the port that this service should serve on
    - port: 80
      nodePort: 30080
  selector:
    name: frontend
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>sukuriu ir startuoju frontedinę paslaugą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl create -f frontend-service.yaml
service/frontend created
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu frontendinės paslaugos būseną:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get services
NAME           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)        AGE
frontend       NodePort    10.96.81.216   &lt;none&gt;        80:30080/TCP   114s
kubernetes     ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP        45m
redis-master   ClusterIP   10.98.222.56   &lt;none&gt;        6379/TCP       39m
redis-slave    ClusterIP   10.98.98.227   &lt;none&gt;        6379/TCP       37m
controlplane $</pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="__ingsnis_4_8_strong_jungiam_s_sve_i_knygos_frontend_strong">Žingsnis 4.8: <strong>Jungiamės į „Svečių knygos“ frontendą</strong></h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>tikrinu visų „ankščių“ būsenas (įsk. ir frontendines):</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl get pods
NAME                 READY   STATUS    RESTARTS   AGE
frontend-ctpql       1/1     Running   0          43m
frontend-dwkqh       1/1     Running   0          43m
frontend-g998c       1/1     Running   0          43m
redis-master-bv75w   1/1     Running   0          55m
redis-slave-bfzm9    1/1     Running   0          49m
redis-slave-f5f9f    1/1     Running   0          49m
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>išsifiltruoju frontendinės paslaugos <em>NodePort</em> prievadą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre>controlplane $ kubectl describe service frontend | grep NodePort:
NodePort:                 &lt;unset&gt;  30080/TCP
controlplane $</pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>tikrinu Web-aplikaciją tiesiogiai (URL gautas iš treniruoklio puslapio):
                    <br>
                    <a href="https://2886795348-30080-frugo01.environments.katacoda.com/" class="bare">https://2886795348-30080-frugo01.environments.katacoda.com/</a></p>
                  <div class="imageblock">
                    <div class="content">
                      <img src="https://user-images.githubusercontent.com/74717106/149956447-fb106765-4990-4f70-8d05-24dc87f3c052.png"
                        alt="149956447 fb106765 4990 4f70 8d05 24dc87f3c052">
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>&#160;</p>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_suvestin_nr_4">Suvestinė nr. 4:</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Įvykdžiau diegimą pagal YAML šabloną (arba YAML apibrėžtį, angl.
                    <em>definition</em>):</p>
                  <div class="olist arabic">
                    <ol class="arabic">
                      <li>
                        <p>gavau Shell su veikiančiu <em>K8s</em> miniklasteriu;</p>
                      </li>
                      <li>
                        <p>taip pat gavau šešis YAML šablonus:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p><code>redis-master-controller.yaml</code></p>
                            </li>
                            <li>
                              <p><code>redis-master-service.yaml</code></p>
                            </li>
                            <li>
                              <p><code>redis-slave-controller.yaml</code></p>
                            </li>
                            <li>
                              <p><code>redis-slave-service.yaml</code></p>
                            </li>
                            <li>
                              <p><code>frontend-controller.yaml</code></p>
                            </li>
                            <li>
                              <p><code>frontend-service.yaml</code></p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li>
                        <p>pagal juos įdiegiau:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p><code>redis-master</code> replikacinį valdiklį iš Docker
                                atvaizdo <code>redis:3.0.7-alpine</code>;</p>
                            </li>
                            <li>
                              <p><code>redis-master</code> paslaugą (1 vnt.);</p>
                            </li>
                            <li>
                              <p><code>redis-slave</code> replikacinį valdiklį iš Docker
                                atvaizdo <code>gb-redisslave:v1</code>;</p>
                            </li>
                            <li>
                              <p><code>redis-slave</code> paslaugą (2 vnt.);</p>
                            </li>
                            <li>
                              <p><code>frontend</code> replikacinį valdiklį iš Docker
                                atvaizdo <code>gb-frontend:v3</code>;</p>
                            </li>
                            <li>
                              <p><code>frontend</code> paslaugą (3 vnt.);</p>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li>
                        <p>patikrinau būsenas:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p>replikacinių valdiklių,</p>
                            </li>
                            <li>
                              <p>paslaugų</p>
                            </li>
                            <li>
                              <p>„ankščių“,</p>
                              <div class="paragraph">
                                <p>&#8201;&#8212;&#8201;veikia 3 valdikliai, 3 paslaugos
                                  ir 6 „ankštys“.</p>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </li>
                      <li>
                        <p>patikrinau paslaugos veikimą iš išorinio interneto&#8201;&#8212;&#8201;veikia
                          puikiai (tik primityviai);</p>
                      </li>
                      <li>
                        <p>tyrimas baigtas.</p>
                      </li>
                    </ol>
                  </div>
                </li>
                <li>
                  <p>Naudojant YAML failus man <strong>tampa išvis neaišku</strong>,
                    kaip konfigūruoti moduliai sąveikauja žemame lygmenyje. <br>                    Suvokiu tik abstraktų vaizdą, ir visiškai neaišku, kaip reikėtų
                    tikrinti srautus / paslaugų strigimus įprastinėmis OS priemonėmis.</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_laboratorinio_darbo_i_vados">Laboratorinio darbo išvados</h4>
            <div class="paragraph">
              <p>Minimaliai susipažinta su Kubernetes platforma.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>
