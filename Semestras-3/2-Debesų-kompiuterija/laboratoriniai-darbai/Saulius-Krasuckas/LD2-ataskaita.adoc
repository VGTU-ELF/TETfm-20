= {nbsp}{nbsp}{nbsp}{nbsp}{nbsp}{nbsp}Vilniaus Gedimino technikos universitetas

[.text-center]
== Elektronikos fakultetas

=== Kompiuterijos ir ryšių technologijų katedra

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

=== Debesų kompiuterija
Modulis ELKRM17304

[.text-center]
== Susipažinimas su Docker konteineriais

Laboratorinio darbo nr. 2 ataskaita

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

[.text-right]
**Atliko:** TETfm-20 grupės magistrantas +
                       Saulius Krasuckas +
**Tikrino:** lekt. dr. Liudas Duoba

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

{nbsp}

VILNIUS, 2022

<<<



{nbsp}

[.text-center]
==== Laboratorinis darbas nr. 2

[.text-center]
== Susipažinimas su Docker konteineriais


{nbsp}

[.text-center]
=== Darbo tikslas

[.text-left]
* Pasinaudoti pagrindinėmis _Docker_ funkcijomis.
* Iš pirminio (angl. _Source_) failo sukurti ir startuoti konteinerio atvaizdį (angl. _Image_).


[.text-center]
=== Darbo eiga


[.text-left]
=== Užduotis nr. 1: **Prisijungimas prie Jūsų virtualaus serverio**

. Prisijungiu panaudodamas MinTTY terminalo emuliatorių ir MSYS2 OpenSSH klientinę programą:
+
image::https://user-images.githubusercontent.com/74717106/151711886-8d802745-8af7-492d-8bed-4beb09165fa5.png[width=100%]
+
=> Prisijungti po ilgo klientinės programos ruošimo ir komandinės eilutės prisiminimo pavyko.


[.text-left]
=== Užduotis nr. 2: **_Docker_ tyrinėjimas**

. Tikrinu _Docker_ įdiegtumą ir veikimą:
+
image::https://user-images.githubusercontent.com/74717106/151711802-dcd2b889-8340-4493-a25c-a2f2ee9367ef.png[width=100%]
+
=> Dokeris įdiegtas ir veikia, jo versija: **20.10.8**

. Startuoju pavyzdinį atvaizdį:
+
image::https://user-images.githubusercontent.com/74717106/151711746-cb0d9711-cd27-44f8-a3cb-758ed68d0360.png[width=100%]
+
=> Gauta išvestis atitinka LD aprašą.
+
Vykdau `run` komandą pagal naujovišką _Docker_ komandinę sąrangą:
+
image::https://user-images.githubusercontent.com/74717106/151711684-0d4a525c-5810-45fa-9a3e-a6979f68fc3c.png[width=100%]
+
=> Gaunu tokią pat išvestį.  +
=> Daugiau CLI raidžių, aiškesnė esmė.

. _Docker_ registre ieškau _Ubuntu_ atvaizdžių:
+
image::https://user-images.githubusercontent.com/74717106/151711620-77b93648-b27a-42c7-a476-9ccff89a560e.png[width=100%]


. Tikrinu mašinoje veikiančius (jau startavusius konteinerius)
+
image::https://user-images.githubusercontent.com/74717106/151712025-7180f807-0ff0-4f5b-acb4-c4680b1aa042.png[width=100%]
+
=> Kol kas šioje mašinoje nematyti nei vieno veikiančio konteinerio.


. Pirmiausia mėginu `ubuntu` atvaizdžio startavimą dviem žingsniais:
+
image::https://user-images.githubusercontent.com/74717106/151712236-959a7abf-a792-4ac7-9c57-3bb797ef788d.png[width=100%]
* parsitempiu jį iš Dokerio registro;
* startuoju jį tiesiogiai.


. Po to mėginu tai pakartoti ir vienu žingsniu:
+
image::https://user-images.githubusercontent.com/74717106/151712380-28f960be-f556-47f2-855f-db851634c450.png[width=100%]
+
=> Vykdymas (pagal klaidų nebuvimo) lyg prasidėjo abiem atvejais, nors akivaizdaus pagrindimo ir neturiu.


. Kadangi prireiks dviejų SSH sesijų vienu metu,
klientinėje pusėje įsidiegiu terminalo multiplekserį lengvam persijungimui tarp šių sesijų:
+
image::https://user-images.githubusercontent.com/74717106/151712613-3c18a1fd-6c82-45c7-bc39-7a8abb01e072.png[width=100%]
+
{nbsp}
+
Tuomet startuoju jį ir jungiuosi į serverį iš naujo jau jame:
+
image::https://user-images.githubusercontent.com/74717106/151712805-b3026d05-4d8f-48a8-872a-c7d612d0104a.png[width=100%]
+
Pirmoje SSH sesijoje startuoju jau išbandytą `busybox` konteinerį interaktyviu režimu + nurodau alokuoti jam terminalą:
+
image::https://user-images.githubusercontent.com/74717106/151712933-d8f023e4-15d0-4048-8eb0-b687c7fff278.png[width=100%]
+
=> Konteineris startavo ir leidžia vykdyti jame interaktyvias programas.


. Prisijungiu prie serverio jau antra SSH sesija:
+
image::https://user-images.githubusercontent.com/74717106/151713032-f0e01e93-a41e-46b1-b5ff-71ae6dbe7171.png[width=100%]
+
Ir peržiūriu jame veikiančius konteinerius:
+
image::https://user-images.githubusercontent.com/74717106/151713064-54318bf1-facd-4fef-a287-6069ab8dcd86.png[width=100%]
+
=> Matyti lygiai vienas veikiantis, iš `busybox` atvaizdžio startavęs konteineris su ID=`22e032ddc36b`.  +
   Prieš tai nebuvo matyti jokio veikiančio konteinerio.
+
Išeinu iš interaktyvios Shell sesijos, uždarau konteinerį:
+
image::https://user-images.githubusercontent.com/74717106/151713375-06457251-23b1-4d46-8cd2-95bc3b546c00.png[width=100%]


. Savo pradinėje direktorijoje sukuriu subdirektoriją `test_directory`, o joje bandomąjį failą `test.file`:
+
image::https://user-images.githubusercontent.com/74717106/151713479-2ba26e5c-1427-458d-a941-59c11814ef77.png[width=100%]


. Startuoju konteinerį (guestą) šįkart prijungdamas jam hosto direktoriją:
+
image::https://user-images.githubusercontent.com/74717106/151713588-c46445a4-2990-4fe9-bb59-903217308887.png[width=100%]
+
Jame vykdau komandą `ls`:
+
image::https://user-images.githubusercontent.com/74717106/151713838-90fbc4ef-0d46-46b8-9c7f-8af6ff7f2d08.png[width=100%]
+
=> ... ir konteinerio viduje matau ir testinę direktoriją, ir testinį failą joje.

. (Bonus) Tikrinu duomenų perdavimą iš konteinerio į hostą:

* startuoju konteinerį dar sykį;
* papildau testinį failą gueste;
* uždarau konteinerį;
* patikrinu, ar tikrai užsidarė;
* peržiūriu testinio failo turinį hoste.
. :
+
image::https://user-images.githubusercontent.com/74717106/151714009-314af166-4cf0-4b56-aa38-3f071ab7505e.png[width=100%]
+
=> Gueste įrašyti duomenys tikrai išliko ir hoste.


[.text-left]
=== Užduotis nr. 3: **_Web_-serviso atvaizdžio sukūrimas pagal _Dockerfile_**

. Pradedu kurti aplikacijos vykdomajį failą `main_app.py`:
+
image::https://user-images.githubusercontent.com/74717106/151714369-5e1e0d8f-75bf-46d4-b8a2-a86db33e1570.png[width=100%]
+
Perkopijuoju kodą iš `paste.ofcode.org`:
+
image::https://user-images.githubusercontent.com/74717106/151714531-a0e6db06-e562-46f6-9c86-bd4510277ecb.png[width=100%]
+
\... į redaktorių **vim**:
+
image::https://user-images.githubusercontent.com/74717106/151714459-c828609f-878f-4045-80c2-1ea279d6691b.png[width=100%]


. Sukuriu ir kitą failą, šakninio puslapio šabloną `views/index.tpl`:
+
image::https://user-images.githubusercontent.com/74717106/151714688-db26ce62-c681-418c-b33f-e799f1142bea.png[width=100%]
+
Perkopijuoju jo kodą iš `paste.ofcode.org`:
+
image::https://user-images.githubusercontent.com/74717106/151714718-ba6eb013-f507-4f78-91f4-cc03893231ff.png[width=100%]
+
\... irgi į **vim**:
+
image::https://user-images.githubusercontent.com/74717106/151714878-0676e2ac-7710-48fe-bd54-b4056ce41e27.png[width=100%]


. Paruošiu pildymui failą `Dockerfile`:
+
image::https://user-images.githubusercontent.com/74717106/151714976-c8a68720-ae94-4d95-b626-1fc58c94ea22.png[width=100%]
+
Nusikopijuoju duomenis iš `paste.ofcode.org`:
+
image::https://user-images.githubusercontent.com/74717106/151715060-d82b0eb9-9ba6-46ad-923b-75fb3d9f078e.png[width=100%]
+
\... ir įrašau juos į failą su **vim**:
+
image::https://user-images.githubusercontent.com/74717106/151715107-9d879e3a-a052-4e97-86bd-2ba00a128868.png[width=100%]
+
Taip pat pataisau `pip` => `pip3` ir papildau `apt-get install` papildomu paketo vardu `python3`
pagal grupioko Edgaro pastebėjimus bei konteinerio apraše nurodau savo ID:
+
image::https://user-images.githubusercontent.com/74717106/151715469-7ea92444-61c3-4794-91de-84b83248a90d.png[width=100%]


. Bandau sukurti Docker atvaizdį:
+
image::https://user-images.githubusercontent.com/74717106/151715631-62b5f3a2-ca31-47b5-80fe-06eb3da4e516.png[width=100%]
+
=> Deja, klaida.
+


. Klaidų identifikavimas ir taisymas.

* Įsidiegiu įrankį `tree`:
+
image::https://user-images.githubusercontent.com/74717106/151716116-5426393d-bc2f-4a2d-b7c5-9e2d3af6e776.png[width=100%]

* Patikrinu savo pradinės direktorijos struktūrą:
+
image::https://user-images.githubusercontent.com/74717106/151716159-4f395a2f-fee4-4967-b264-1dbbb31da4be.png[width=100%]

* Įdiegiu `diff` įrankio spalvotuvą (būsimam savo failų palyginimui):
+
image::https://user-images.githubusercontent.com/74717106/151716238-f963c911-2b24-4302-91ee-faeb869f5343.png[width=100%]

* Patikrinu skirtumą tarp originalaus ir savo pataisyto `Dockerfile`:
+
image::https://user-images.githubusercontent.com/74717106/151716282-72855155-65cb-4279-95b9-6059d51e8d60.png[width=100%]

* Pasidarau dar vieną atsarginę jo kopiją:
+
image::https://user-images.githubusercontent.com/74717106/151716452-514e8e42-dafc-43aa-848d-daf3d09a382b.png[width=100%]

* ... ir taisau `Dockerfile` pagal dėstytojo nurodymus:
+
image::https://user-images.githubusercontent.com/74717106/151716348-012247d5-8f4f-423d-b880-b0b12b956f4a.png[width=100%]

* ... bei vizualizuoju visus failo pataisymus:
+
image::https://user-images.githubusercontent.com/74717106/151716681-a01198cf-f9d7-40fd-ab60-65412eafe1f0.png[width=100%]

* Tačiau klaidos kuriant atvaizdį išlieka:
+
image::https://user-images.githubusercontent.com/74717106/151716729-78fe0741-f210-4bb0-b2fe-c37b03e871f0.png[width=100%]

* => Gaunu iš dėstytojo patikslinimą atvaizdžio kūrimo failams susikurti atskirą direktoriją.

* Taip ir padarau bei į ją perkeliu jau turimus darbinius failus:
+
image::https://user-images.githubusercontent.com/74717106/151716894-ce64bfb7-d95d-4152-80cb-4d39c0e31897.png[width=100%]

* => Visos klaidos lyg ištaisytos.


. Kartoju konteinerio kūrimą:  +
  (ketvirto žingsnio pratęsimas)
+
image::https://user-images.githubusercontent.com/74717106/151717076-443a2475-881b-486a-ae2e-f51b2fd595e6.png[width=100%]
+
=> Šį sykį kūrimas prasideda sėkmingai.
+
Įvyksta paketų, skirtų konteineriui, naujinimas:
+
image::https://user-images.githubusercontent.com/74717106/151717161-043aed37-3a85-443d-b655-d55f73d3250a.png[width=100%]
+
Taip pat pasirodo ir kažkokios `debconf` klaidos bei viena `dpkg-reconfigure` klaida:
+
image::https://user-images.githubusercontent.com/74717106/151717183-d2e90fc3-124b-45f5-97f1-72fae9cc0314.png[width=100%]
+
Ir galiausiai konteinerio atvaizdis yra sėkmingai sukuriamas:
+
image::https://user-images.githubusercontent.com/74717106/151717419-659aa8de-fddb-44d6-ac31-f36952ba043d.png[width=100%]
+
=> Kūrimas užtruko bent keletą minučių.
+
Patikrinu, ar atvaizdis atsirado vietinėje talpykloje (angl. _Local image cache_):
+
image::https://user-images.githubusercontent.com/74717106/151717523-0e296cf6-bd4c-41d3-9d8c-5ad16f406ae7.png[width=100%]
+
* => Atvaizdis atsirado vietinėje talpykloje, kūrimas baigtas.

. Konteinerio startavimas iš naujojo atvaizdžio.
+
Deja, gaunu _Python_ sintaksės klaidą:
+
image::https://user-images.githubusercontent.com/74717106/151717695-1f9edb1a-600e-4ed8-a3be-90799c9d2138.png[width=100%]
+
Pradedu redaguoti failą:
+
image::https://user-images.githubusercontent.com/74717106/151717794-90f78539-b68b-4da5-8dca-5780e09dc498.png[width=100%]
image::https://user-images.githubusercontent.com/74717106/151717849-649d4da1-d1b6-41d3-a2c4-2cfcab27ee73.png[width=100%]
+
Ir taisau kabutes į paprastas 12-oje ir 14-oje eilutėse:
+
image::https://user-images.githubusercontent.com/74717106/151717934-d9adb7c1-32bf-4413-bda5-b7fd75494c54.png[width=100%]
+
Bei paleidžiu atvaizdžio perkūrimą iš naujo:
+
image::https://user-images.githubusercontent.com/74717106/151718032-706aec1d-7fdd-442c-b8dd-4e2952035a98.png[width=100%]
+
.=> Šį sykį kūrimas užtruko nepilnas 4 sekundes/
+
Startuoju konteinerį neatjungiamuoju (angl. _Non-detached_), pirmaplaniu (angl. _Foreground_) režimu, parenkamu pagal nutylėjimą.
+
image::https://user-images.githubusercontent.com/74717106/151718212-943e2670-8db6-49e9-bc19-7342a3b30bf2.png[width=100%]
+
Tikrinu serviso pasiekiamumą išoriniame internete, iš namų tinklo:
+
image::https://user-images.githubusercontent.com/74717106/151718428-1e791699-6603-4e41-9cf6-465325c4bdde.png[width=100%]
+
=> Veikia puikiai!
+
Trumpam sustabdau konteinerį, veikiantį pirmaplaniu režimu:
+
image::https://user-images.githubusercontent.com/74717106/151718648-94146af3-ed78-4b97-871b-c396fd9545a1.png[width=100%]
+
Ir startuoju jį jau atjungiamuoju (angl. _Detached_) arba antraplaniu (angl. _Background_) režimu:
+
image::https://user-images.githubusercontent.com/74717106/151718741-728d8195-6f5a-43f4-9609-a244be2040ca.png[width=100%]
+
Peržiūriu veikiančių konteinerių sąrašą:
+
image::https://user-images.githubusercontent.com/74717106/151718827-7c49a676-ee74-4cac-9a79-3528158e6a6e.png[width=100%]
+
=> Vienas konteineris veikia ir aptarnauja hosto `80/TCP` prievadą.
+
=> **raktas `-d`** įjungia antraplanį konteinerio vykdymo režimą.  +
   Šis režimas reiškia, kad pagrindinis konteinerio procesas „atsikabina“ nuo vartotojo terminalo ir pereina į užnugarinį, antraplanį aplikacijos vykdymą.  +
   Konteinerio _Stdin_, _Stdout_, _Stderr_ srautai terminale uždaromi.
+
=> **raktas `-rm`** nurodo Dokeriui ištrinti vidinius konteinerio failus.  +
   Pagal nutylėjimą jei lieka po konteinerio įvykdymo ir atspindi jo galutinę būseną.  +
   Įprastai šie failai naudojami derinant konteinerius.
   Tačiau jei konteineris startuojamas dažnai, tikėtina, kad šie būsenų failai pradės užimti žymią dalį diskinės talpos.  +
   Raktas praverčia, kai siekiame išvengti pastarojo reiškinio.


. (Bonus) Lygiagretus papildomų konteinerių vykdymas.
+
Startuoju antrą konteinerį iš to paties atvaizdžio ir susieju su hosto `81/TCP` prievadu:
+
image::https://user-images.githubusercontent.com/74717106/151719049-dd161e40-2a22-4011-94d0-77f1c5c352af.png[width=100%]
+
Startuoju ir trečią konteinerį iš ten pat, susieju su hosto `82/TCP` prievadu, nurodau savo sugalvotą vardą bei peržiūriu veikiančių konteinerių sąrašą:
+
image::https://user-images.githubusercontent.com/74717106/151719157-68b8cf05-af8c-4a4b-ab90-9a06c9ba2143.png[width=100%]
+
Jei mėginu startuoti ketvirtą konteinerį, bet jau naudojamu vardu, gaunu klaidą:
+
image::https://user-images.githubusercontent.com/74717106/151719241-74052a10-d2e7-41cb-a5c8-1465703fb58c.png[width=100%]


. Patikrinu serviso lokalų pasiekiamumą hosto prievadu `80/TCP`  +
(šįkart konteineriui veikiant antraplaniu režimu):
+
image::https://user-images.githubusercontent.com/74717106/151720257-8cfdd2a1-8431-4b34-a31e-c662a0bf4b9c.png[width=100%]
+
Įsijungiu naršyklę ir dar sykį patikrinu to paties serviso puslapį (pasiekiamumą internetu):
+
image::https://user-images.githubusercontent.com/74717106/151719955-d08c3123-b0ca-4ed9-9136-f898fbaff13f.png[width=100%]
=> Laboratorinis _Web_-servisas veikia ir atsiliepia tiek lokaliai, tiek internetu.

---

[.text-left]
=== Laboratorinio darbo pabaiga

* Susipažinta su _Docker_ komandų sistema ir keliomis pagrindinėmis funkcijomis:

 ** `image ls`
 ** `container run`
 ** `container ls`
 ** `search`
 ** `image pull`
 ** `build`
 ** `image ls`

* Pramokta `Dockerfile` sintaksė ir pirminio failo sukurtas nuosavas atvaizdis bei iš jo lygiagrečiai startuoti trys konteineriai, aptarnaujantys skirtingus hosto TCP prievadus.

* Patikrintas konteinerizuotos, _Python_ kalba sukurtos _Web_-aplikacijos veikimas lokaliai ir internetu.
