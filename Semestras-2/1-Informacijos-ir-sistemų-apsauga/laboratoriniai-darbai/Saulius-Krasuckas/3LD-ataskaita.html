<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 1.5.4">
  <title>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Vilniaus Gedimino technikos
    universitetas</title>
  <link rel="stylesheet" href="https://asciidoclive.com/assets/asciidoctor.js/css/asciidoctor.css">
</head>

<body class="article">
  <div id="header">
    <h1>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Vilniaus Gedimino technikos
      universitetas</h1>
  </div>
  <div id="content">
    <div class="sect1 text-center">
      <h2 id="_elektronikos_fakultetas">Elektronikos fakultetas</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="_kompiuterijos_ir_ry_i_technologij_katedra">Kompiuterijos ir ryšių technologijų katedra</h3>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
          <div class="paragraph">
            <p>&#160;</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="_informacijos_ir_sistem_apsauga">Informacijos ir sistemų apsauga</h3>
          <div class="paragraph">
            <p>Modulis ELKRM17209</p>
          </div>
          <div class="sect3">
            <h4 id="_laboratorinio_darbo_nr_3_ataskaita">Laboratorinio darbo nr. 3 ataskaita</h4>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph text-right">
              <p><strong>Atliko:</strong> TETfm-20 grupės magistrantas<br> Saulius Krasuckas<br>
                <strong>Tikrino:</strong> doc. dr. Eimantas Garšva</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>&#160;</p>
            </div>
            <div class="paragraph">
              <p>VILNIUS, 2021</p>
            </div>
            <div style="page-break-after: always;"></div>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_darbo_tikslas">Darbo Tikslas</h3>
          <div class="ulist checklist">
            <ul class="checklist">
              <li>
                <p>&#10003; Patikrinti tinklo nustatymus. <br></p>
              </li>
              <li>
                <p>&#10003; Susipažinti su <code>iptable</code> sintakse.<br></p>
              </li>
              <li>
                <p>&#10003; Nustatyti paprastą tarpsegmentinį ekraną.</p>
              </li>
            </ul>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_trumpas_atlikto_darbo_apra_ymas">Trumpas atlikto darbo aprašymas</h3>
          <div class="sect3">
            <h4 id="_1_virtualaus_kompiuterio_konfig_racija">1. Virtualaus kompiuterio konfigūracija</h4>
            <div class="paragraph">
              <p>Tikrinu IP adresus.</p>
            </div>
            <div class="paragraph">
              <p>Tikrinu maršrutizacijos lentelę.</p>
            </div>
            <div class="paragraph">
              <p>Pataisau <code>interfaces</code> failą ir palyginu su ankstesne versija.</p>
            </div>
            <div class="paragraph">
              <p>Aktyvuoju pakeistus nustatymus.</p>
            </div>
            <div class="paragraph">
              <p>Abu IP adresai, prašomi LD3, nurodyti.</p>
            </div>
            <div class="paragraph">
              <p>Vieninteliai vartai pagal nutylėjimą yra <code>192.168.10.254</code>,
                kaip ir prašo LD3 aprašas.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_2_tinklo_paslaug_tikrinimas">2. Tinklo paslaugų tikrinimas</h4>
            <div class="paragraph">
              <p>Diegiu grafinę priemonę <code>sysvconfig</code>.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Programinės įrangos valdymo įrankis neranda minimos priemonės.</p>
                </li>
                <li>
                  <p>Įrankio paieškos apibendrinimas:</p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>įrankis <code>chkservice</code> gana tiksliai atitinka <code>sysvconfig</code>;</p>
                      </li>
                      <li>
                        <p>puikiai veikia su SystemD <em>Init</em>-mechanizmu;</p>
                      </li>
                      <li>
                        <p>tik nerodo tarnybų priklausomybių nuo <em>Runlevels</em>                          (arba nuo <em>targets</em>, kalbant SystemD terminais).</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>SSH serverio instaliavimas.</p>
            </div>
            <div class="paragraph">
              <p>Tą patį pakartojau ir kaimyniniame kompiuteryje.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_3_tinklo_paslaug_tikrinimas">3. Tinklo paslaugų tikrinimas</h4>
            <div class="paragraph">
              <p>Teikiamos tinklo paslaugos.</p>
            </div>
            <div class="paragraph">
              <p>Jungiuosi prie kaimyno per SSH.</p>
            </div>
            <div class="paragraph">
              <p>Stebiu paslaugų būvio pasikeitimą.</p>
            </div>
            <div class="paragraph">
              <p>Palyginimui įrašiau komandos išvesti abu kartus į skirtingus failus.
                <br> Tuomet pasinaudojau įrankiu <code>diff -u</code>.</p>
            </div>
            <div class="paragraph">
              <p>Iš tinklinių (ne <em>Unix-socket</em>) prisijungimų atsirado du nauji
                įrašai:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>tcp        0      0 192.168.10.14:51672     192.168.10.13:22        TIME_WAIT
tcp        0      0 192.168.10.14:51674     192.168.10.13:22        ESTABLISHED</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Pirmasis iš jų yra rodo mano pirmą bandymą prisijungti (nepavykusi
                    autentikacija ir nutrūkęs ryšys).</p>
                </li>
                <li>
                  <p>Antrasis iš jų yra rodo antrą, sėkmingą bandymą prisijungti.</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_4_kaimyno_skenavimas">4. Kaimyno skenavimas</h4>
            <div class="paragraph">
              <p>Rezultatai:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ sudo nmap -sS -P0 -n -F 192.168.10.13
Starting Nmap 7.80 ( https://nmap.org ) at 2021-07-04 20:37 EEST
Nmap scan report for 192.168.10.13
Host is up (0.00067s latency).
Not shown: 99 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
MAC Address: 08:00:27:7A:D0:B7 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.54 seconds</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Kaimyno kompiuteryje matau prieinamą tik vieną paslaugą / tarnybą:</p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>SSH</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Taip pat nuskenavau ir savo kompiuterį iš kaimyninio kompiuterio: <br>                (kadangi žiniatinklis paruoštas tik savajame)</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm2:~$ sudo nmap -sS -P0 -n -F 192.168.10.14
Starting Nmap 7.80 ( https://nmap.org ) at 2021-07-05 07:23 EDT
Nmap scan report for 192.168.10.14
Host is up (0.0013s latency).
Not shown: 97 closed ports
PORT    STATE SERVICE
22/tcp  open  ssh
80/tcp  open  http
443/tcp open  https
MAC Address: 08:00:27:40:2C:F6 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.97 seconds</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Savajame kompiuteryje matau prieinamas jau tris paslaugas / tarnybas:</p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>SSH</p>
                      </li>
                      <li>
                        <p>HTTP</p>
                      </li>
                      <li>
                        <p>HTTPS</p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_5_paket_persiuntimo_jungimas">5. Paketų persiuntimo įjungimas</h4>
            <div class="paragraph">
              <p>Įjungiu persiuntimą faile.</p>
            </div>
            <div class="paragraph">
              <p>Peržiūriu įkeltus modulius.</p>
            </div>
            <div class="paragraph">
              <p>Nustatau automatinį poros modulių užkrovimą.</p>
            </div>
            <div class="paragraph">
              <p>Nerperkraudamas kompiuterio nustatau šias vertes tiesioges.</p>
            </div>
            <div class="paragraph">
              <p>Patikrinu.</p>
            </div>
            <div class="paragraph">
              <p>Nustatymas įvyko, o <code>iptable_nat</code> modulis įkeltas į branduolio
                erdvę (kartu su dar penkiais moduliais).</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_6_code_iptables_code_patikrinimas">6. <code>iptables</code> patikrinimas</h4>
            <div class="paragraph">
              <p>Peržiūriu nustatymus pagal nutylėjimą.</p>
            </div>
            <div class="paragraph">
              <p>Uždraudžiu įeinančius paketus.</p>
            </div>
            <div class="paragraph">
              <p>Išbandau draudimą, veikia.</p>
            </div>
            <div class="paragraph">
              <p>Ryšys iš kaimyninio kompiuterio nebeužsimezga, įvyksta <em>Timeout</em>.</p>
            </div>
            <div class="paragraph">
              <p>Žiūriu, kaip pasikeitė nustatymai.</p>
            </div>
            <div class="paragraph">
              <p>Atsirado viena nauja eilutė: <code>DROP       all &#8201;&#8212;&#8201; anywhere             anywhere</code></p>
            </div>
            <div class="paragraph">
              <p>Išvalau <code>iptables</code>.</p>
            </div>
            <div class="paragraph">
              <p>Patikrinu ICMP pingą iš kaimyninio kompiuterio.</p>
            </div>
            <div class="paragraph">
              <p>Uždraudžiu ICMP protokolą.</p>
            </div>
            <div class="paragraph">
              <p>Tikrinu, ar atsirado taisyklė:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ diff -u debug/{09,11}*.txt
--- "debug/09.iptables_iki_bandym\305\263.txt"  2021-07-04 22:08:14.293905599 +0300
+++ "debug/11.iptables_po_ICMP_taisykl\304\227s.txt"    2021-07-04 22:45:28.062899693 +0300
@@ -1,5 +1,6 @@
 Chain INPUT (policy ACCEPT)
 target     prot opt source               destination
+DROP       icmp --  anywhere             anywhere

 Chain FORWARD (policy ACCEPT)
 target     prot opt source               destination</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Tikrinu ją, veikia.</p>
            </div>
            <div class="paragraph">
              <p>Kompiuteris į ICMP pingą nebeatsako.</p>
            </div>
            <div class="paragraph">
              <p>Išvalau <code>iptables</code>.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_7_kompiuterio_apsaugojimas_nuo_resursus_i_naudojan_io_icmp_srauto">7. Kompiuterio apsaugojimas nuo resursus išnaudojančio ICMP srauto</h4>
            <div class="paragraph">
              <p>Paleidžiu <code>ping</code> srautą į virtualų kompiuterį.</p>
            </div>
            <div class="paragraph">
              <p>Stebiu, kaip vykdoma komanda:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>64 bytes from 192.168.10.14: icmp_seq=1 ttl=64 time=0.439 ms
64 bytes from 192.168.10.14: icmp_seq=2 ttl=64 time=0.567 ms
64 bytes from 192.168.10.14: icmp_seq=3 ttl=64 time=0.745 ms
64 bytes from 192.168.10.14: icmp_seq=4 ttl=64 time=0.568 ms</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Sustabdau srautą <code>Ctrl+C</code> pagalba:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>^C
--- 192.168.10.14 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 3000ms
rtt min/avg/max/mdev = 0.439/0.579/0.745/0.112 ms</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Nustatau apribojimą 1 šalt./s:</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Deja, virtualaus kompiuterio reakcija į <em>ping</em> srautą nepasikeitė.
                    <br> Įtarimų sukėlė <code>-j ACCEPT</code> ir <code>Chain INPUT (policy ACCEPT)</code>.</p>
                </li>
                <li>
                  <p>Papildau, kad <code>iptables</code> atmestų visus ICMP paketus,
                    neatitikusius šios taisyklės.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Vėl paleidžiu <em>ping</em> srautą.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>[p@localhost Saulius-Krasuckas]$ ping 192.168.10.14
PING 192.168.10.14 (192.168.10.14) 56(84) bytes of data.
64 bytes from 192.168.10.14: icmp_seq=2 ttl=64 time=0.771 ms
64 bytes from 192.168.10.14: icmp_seq=4 ttl=64 time=0.665 ms
64 bytes from 192.168.10.14: icmp_seq=6 ttl=64 time=0.623 ms
64 bytes from 192.168.10.14: icmp_seq=8 ttl=64 time=0.636 ms
^C
--- 192.168.10.14 ping statistics ---
8 packets transmitted, 4 received, 50% packet loss, time 7000ms
rtt min/avg/max/mdev = 0.623/0.673/0.771/0.066 ms</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Dabar iš aštuonių paketų per 7s atkeliavo tik 4 (50%). <br> Kompiuteris
                atmeta kas antrą ICMP paketą. <br> Panašu, kad įeinančio ICMP srauto
                ribojimas dabar veikia.</p>
            </div>
            <div class="paragraph">
              <p>Išvalau <code>iptables</code>.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_8_em_telnet_em_u_draudimas">8. <em>Telnet</em> uždraudimas</h4>
            <div class="paragraph">
              <p>Registruoju <em>Telnet</em> užklausas žurnale ir jų neleidžiu.</p>
            </div>
            <div class="paragraph">
              <p>Kreipiuosi iš realaus į savo virtualų kompiuterį <em>Telnet</em> protokolu.</p>
            </div>
            <div class="paragraph">
              <p>Peržiūriu įrašus jo žurnale.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ tail -0f /var/log/syslog
Jul  5 10:00:26 ldvm1 kernel: [ 7539.021434] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=46720 DF PROTO=TCP SPT=52720 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Kreipiuosi iš kaimyno į savo virtualų kompiuterį <em>Telnet</em> protokolu.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm2:~$ time telnet 192.168.10.14
Trying 192.168.10.14...
telnet: Unable to connect to remote host: Connection refused

real    0m0.013s
user    0m0.006s
sys     0m0.005s</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Užklausa atmetama iškart.</p>
            </div>
            <div class="paragraph">
              <p>O žurnalas vėl pasipildė:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>Jul  5 10:04:18 ldvm1 kernel: [ 7765.363946] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:08:00:27:7a:d0:b7:08:00 SRC=192.168.10.13 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=1374 DF PROTO=TCP SPT=39398 DPT=23 WINDOW=64240 RES=0x00 SYN URGP=0</code></pre>
              </div>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_9_automatin_taisykli_keltis">9. Automatinė taisyklių keltis</h4>
            <div class="paragraph">
              <p>Sukuriu direktoriją taisyklėms saugoti.</p>
            </div>
            <div class="paragraph">
              <p>Sukonfigūruoju <code>iptables</code>:</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>išvalau buvusius nustatymus.</p>
                </li>
                <li>
                  <p>nustatau taisykles pagal nutylėjimą.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Patikrinu konfigūraciją.</p>
            </div>
            <div class="paragraph">
              <p>Įrašau konfigūraciją į failą.</p>
            </div>
            <div class="paragraph">
              <p>Sukuriu failą <code>myfirewall</code>.</p>
            </div>
            <div class="paragraph">
              <p>Kopijuoju į paleidimo sritį.</p>
            </div>
            <div class="paragraph">
              <p>Suteikiu paleidimo teises.</p>
            </div>
            <div class="paragraph">
              <p>Scenarijaus veikimas.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ /etc/init.d/myfirewall
Usage: /etc/init.d/myfirewall {start|stop|show}

osboxes@ldvm1:~$ /etc/init.d/myfirewall show
Current firewall rules:
Failed to list table names in /proc/net/ip_tables_names: Permission denied

osboxes@ldvm1:~$ sudo /etc/init.d/myfirewall show
Current firewall rules:
# Generated by iptables-save v1.8.4 on Mon Jul  5 12:52:52 2021
*filter
:INPUT DROP [46:5323]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [991:138573]
-A INPUT -d 192.168.10.14/32 -p tcp -m tcp --dport 22 -j ACCEPT
-A INPUT -d 192.168.10.14/32 -p tcp -m tcp --dport 443 -j ACCEPT
COMMIT
# Completed on Mon Jul  5 12:52:52 2021
# Generated by iptables-save v1.8.4 on Mon Jul  5 12:52:52 2021
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [3:304]
:POSTROUTING ACCEPT [3:304]
COMMIT
# Completed on Mon Jul  5 12:52:52 2021</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Patikrinu, ar scenarijus išvalo taisykles:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ sudo /etc/init.d/myfirewall stop
Stopping firewall (flushing rules)

osboxes@ldvm1:~$ sudo iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Įkeliu reikiamas <code>iptables</code> taisykles:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ sudo /etc/init.d/myfirewall start
Starting firewall (iptables)</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Tikrinu jų veikimą.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>HTTP paslauga nebeprieinama:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>[p@localhost Saulius-Krasuckas]$ time curl -k http://192.168.10.14
curl: (7) Failed connect to 192.168.10.14:80; Connection timed out

real    2m7.277s
user    0m0.005s
sys     0m0.019s</code></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Klientinė programa <code>curl</code> po 2 min. sulaukia <em>Timeout</em>.</p>
                  </div>
                </li>
                <li>
                  <p>o HTTPS paslauga vis dar prieinama išorei:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>[p@localhost Saulius-Krasuckas]$ time curl -k https://192.168.10.14
&lt;html&gt; ldvm1 (kompiuterio vardas) &lt;/html&gt;

real    0m0.186s
user    0m0.108s
sys     0m0.066s</code></pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Perkaunu virtualų kompiuterį.</p>
            </div>
            <div class="paragraph">
              <p>Pataisau scenarijaus automatinį startą (žr. prie sunkumų).</p>
            </div>
            <div class="paragraph">
              <p>Patikrinu iptables taisykles – dabar jau užsikrovė:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ sudo iptables -L
Chain INPUT (policy DROP)
target     prot opt source               destination
ACCEPT     tcp  --  anywhere             ldvm1                tcp dpt:ssh
ACCEPT     tcp  --  anywhere             ldvm1                tcp dpt:https

Chain FORWARD (policy DROP)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Patikrinu taisyklių veikimą.</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>HTTPS užklausa praleidžiama:</p>
                </li>
              </ul>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>[p@localhost ~]$ curl -k https://192.168.10.14
&lt;html&gt; ldvm1 (kompiuterio vardas) &lt;/html&gt;</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>HTTP užklausa atmetama:</p>
                </li>
              </ul>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>[p@localhost ~]$ curl -m 10 http://192.168.10.14
curl: (28) Connection timed out after 10001 milliseconds</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p><code>iptables</code> taisyklės veikia.</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_10_apsaugoto_kompiuterio_skenavimas">10. Apsaugoto kompiuterio skenavimas</h4>
            <div class="paragraph">
              <p>Skenuoju kaimyną pagal ketvirtą žingsnį:</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Rezultatas identiškas. <br> Taip dėl to, kad tiek žiniatinklį,
                    tiek tarpsegmentinį ekraną konfigūravau savame kompiuteryje,
                    o ne kaimyininiame.</p>
                </li>
                <li>
                  <p>Dėl to skenuoju savo kompiuterį iš kaimyninio.</p>
                </li>
              </ul>
            </div>
            <div class="paragraph">
              <p>Palyginu matomas paslaugas savame kompiuteryje:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm2:~$ sudo nmap -sS -P0 -n -F 192.168.10.14 &gt; debug/02.ldvm1-paslaugos-įjungus-tarpsegmentinį-ekraną.txt
osboxes@ldvm2:~$ diff -u debug/{01,02}*
  ...
 Nmap scan report for 192.168.10.14
-Host is up (0.00068s latency).
-Not shown: 97 closed ports
+Host is up (0.00064s latency).
+Not shown: 98 filtered ports
 PORT    STATE SERVICE
 22/tcp  open  ssh
-80/tcp  open  http
 443/tcp open  https
 MAC Address: 08:00:27:40:2C:F6 (Oracle VirtualBox virtual NIC)</code></pre>
              </div>
            </div>
            <div class="paragraph">
              <p>Matyti, jog savojo kompiuterio prievadas <code>80/TCP</code>, skirtas
                HTTP paslaugai, tapo nebeprieinamas išorėje.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_laboratorinis_darbas_atliktas">Laboratorinis darbas atliktas</h4>
            <div style="page-break-after: always;"></div>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_i_kil_sunkumai_ir_pasteb_ti_netikslumai">Iškilę sunkumai ir pastebėti netikslumai</h3>
          <div class="sect3">
            <h4 id="_1_virtualaus_kompiuterio_konfig_racija_2">1. Virtualaus kompiuterio konfigūracija</h4>
            <div class="paragraph">
              <p>Diegiu grafinę priemonę <code>sysvconfig</code>:</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.10.254  0.0.0.0         UG    0      0        0 enp0s8
default         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3
10.0.2.0        0.0.0.0         255.255.255.0   U     100    0        0 enp0s3
link-local      0.0.0.0         255.255.0.0     U     1000   0        0 enp0s8
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Nustatymai ne visai atitinka LD aprašą:</p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>1. Vietoj <code>eth*</code> tinklo sąsajų vardų Linux naudoja
                          <code>enp0s*</code> vardus. <br> (šiame darbe naudojamas
                          branduolys <code>5.8.0-59-generic</code>) <br> Palieku
                          kaip yra.</p>
                      </li>
                      <li>
                        <p>2. Trūksta <code>10.10.10.x</code> adreso (nes LD2 buvo uždėtas
                          rankomis, o po to OS perkrauta).</p>
                      </li>
                      <li>
                        <p>3. OS turi du vartus pagal nutylėjimą:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p>vienas pasiekiamas per <code>enp0s3</code>, <em>NAT</em>                                tipo tinklo sąsają (su automatiniu IP adresu);</p>
                            </li>
                            <li>
                              <p>kitas pasiekiamas per <code>enp0s8</code>, <em>Host-only</em>                                tipo tinklo sąsają.</p>
                              <div class="literalblock">
                                <div class="content">
                                  <pre>Atsekiau, kad pirmuosius vartus sukonfigūruoja _NetworkManager_ įrankis,
sukurdamas dedikuotą tinklo prisijungimą
(tam atskirą tinklo valdymo abstrakciją):</pre>
                                </div>
                              </div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code>osboxes@ldvm1:~$ nmcli connection show
NAME                UUID                                  TYPE      DEVICE
Wired connection 1  2c671148-b52a-4426-9325-d35a52967e3c  ethernet  enp0s3

osboxes@ldvm1:~$ nmcli connection show id "Wired connection 1" | grep 10.0.2.2
IP4.GATEWAY:                            10.0.2.2
IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 10.0.2.2, mt = 100
DHCP4.OPTION[23]:                       routers = 10.0.2.2</code></pre>
                                </div>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li>
                  <p>Nereikalingus vartus pagal nutylėjimą bandau išmest būtent per
                    <em>NetworkManager</em> kartu su minimu abstrakčiu tinklo prisijungimu:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ sudo nmcli connection delete "Wired connection 1"
Connection 'Wired connection 1' (2c671148-b52a-4426-9325-d35a52967e3c) successfully deleted.</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Tikrinu maršrutizacijos lentelę:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.10.254  0.0.0.0         UG    0      0        0 enp0s8
10.10.10.0      0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
link-local      0.0.0.0         255.255.0.0     U     1000   0        0 enp0s8
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8</code></pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_2_tinklo_paslaug_tikrinimas_2">2. Tinklo paslaugų tikrinimas</h4>
            <div class="paragraph">
              <p>Diegiu grafinę priemonę <code>sysvconfig</code>.</p>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ sudo apt-get install sysvconfig
Reading package lists... Done
Building dependency tree
Reading state information... Done
E: Unable to locate package sysvconfig</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Programinės įrangos valdymo įrankis neranda minimos priemonės.</p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>Mėginu atnaujinti programų sąrašus:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~$ sudo apt-get update
0% [Working]
Err:1 http://security.ubuntu.com/ubuntu focal-security InRelease
  Temporary failure resolving 'security.ubuntu.com'
Err:2 http://us.archive.ubuntu.com/ubuntu focal InRelease
  Temporary failure resolving 'us.archive.ubuntu.com'
Err:3 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease
  Temporary failure resolving 'us.archive.ubuntu.com'
Err:4 http://us.archive.ubuntu.com/ubuntu focal-backports InRelease
  Temporary failure resolving 'us.archive.ubuntu.com'
Reading package lists... Done
W: Failed to fetch http://us.archive.ubuntu.com/ubuntu/dists/focal/InRelease  Temporary failure resolving 'us.archive.ubuntu.com'
W: Failed to fetch http://us.archive.ubuntu.com/ubuntu/dists/focal-updates/InRelease  Temporary failure resolving 'us.archive.ubuntu.com'
W: Failed to fetch http://us.archive.ubuntu.com/ubuntu/dists/focal-backports/InRelease  Temporary failure resolving 'us.archive.ubuntu.com'
W: Failed to fetch http://security.ubuntu.com/ubuntu/dists/focal-security/InRelease  Temporary failure resolving 'security.ubuntu.com'
W: Some index files failed to download. They have been ignored, or old ones used instead.</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Paaiškėja, kad pašalinus vartus pagal nutylėjimą <code>10.0.2.2</code>,
                          nustojo veikti interneto ryšys. <br> Jis veikdavo per tinklo
                          sąsają <code>enp0s3</code>, kuri VirtualBox sistemoje yra
                          <em>NAT</em> tipo (skirta išėjimui į internetą). <br></p>
                      </li>
                      <li>
                        <p>Kadangi dabar ėmė veikti tik vartai per <code>192.168.10.254</code>                          (priklausantys Host OS), teko konfigūruoti maršrutizavimą
                          + įjungti <em>NAT</em> mechanizmą jau Host OS pusėje būtent
                          šiai Guest tinklo sąsajai (o ne įprastinei). <br> (Neaprašau
                          Host OS veiksmų, tai nebūtinai Linux sistema)</p>
                      </li>
                      <li>
                        <p>Sąrašų atnaujinimas vėl veikia:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~$ sudo apt-get update
Hit:1 http://us.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
  ...
Get:21 http://us.archive.ubuntu.com/ubuntu focal-backports/universe Translation-en [2,060 B]
Get:22 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 DEP-11 Metadata [1,780 B]
Get:23 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [288 B]
Fetched 4,078 kB in 10s (391 kB/s)
Reading package lists... Done</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Turbūt vertėtų įtraukti tokį patikslinimą į laboratorinio
                          darbo aprašą. <br> (apie reikiamą <em>VirtualBox</em> tinklo
                          sąsajos tipą + maršrutizavimą tarp Host ir Guest OS)</p>
                      </li>
                      <li>
                        <p>Tęsiu <code>sysvconfig</code> diegimą. Tokio paketo <em>Ubuntu 20.04.2</em>                          neturi:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~$ sudo apt-get install sysvconfig
Reading package lists... Done
Building dependency tree
Reading state information... Done
E: Unable to locate package sysvconfig

osboxes@ldvm1:~$ apt search sysvconfig
Sorting... Done
Full Text Search... Done</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Panašu, kad šis įrankis iš Ubuntu pašalintas 2009-09-11:
                          <br>
                          <a href="https://superuser.com/questions/96040/did-sysvconfig-disappear-in-ubuntu-9-10"
                            class="bare">https://superuser.com/questions/96040/did-sysvconfig-disappear-in-ubuntu-9-10</a></p>
                      </li>
                      <li>
                        <p>Taip pat dabar neveikia ir <code>sysvconfig</code> atitikmenys,
                          dar veikę po jo pašalinimo: <br>
                          <code>sysv-rc-conf</code>, <code>rcconf</code>: <br>
                          <a href="https://askubuntu.com/questions/1043248/rcconf-package-alternative-in-bionic-beaver"
                            class="bare">https://askubuntu.com/questions/1043248/rcconf-package-alternative-in-bionic-beaver</a></p>
                      </li>
                      <li>
                        <p>Panašu, kad jie nebeveikia nuo 2015 m., kai OS atsirado <code>systemd</code>                          mechanizmas. <br> Ir tai kėlė nepatogumų žmonėms, atnaujinantiems
                          Ubuntu jau net nuo versijos <code>14.04</code>: <br>
                          <a href="https://askubuntu.com/questions/1106216/ubuntu-18-04-cant-install-sysv-rc-conf-package-for-managing-startup-services#comment1824791_1106217"
                            class="bare">https://askubuntu.com/questions/1106216/ubuntu-18-04-cant-install-sysv-rc-conf-package-for-managing-startup-services#comment1824791_1106217</a></p>
                      </li>
                      <li>
                        <p>Galbūt reikėtų pagal tai irgi patikslinti LD3 aprašą?</p>
                      </li>
                    </ul>
                  </div>
                </li>
                <li>
                  <p>Ieškau atitikmenų darbui su SystemD mechanizmu. <br>
                    <br> Jeigu pakanka tik patikrinti tarnybų būsenas, tiks komanda
                    <code>systemctl</code>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ systemctl list-unit-files --type=service --all

----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----
UNIT FILE                                  STATE           VENDOR PRESET
accounts-daemon.service                    enabled         enabled
acpid.service                              disabled        enabled
alsa-restore.service                       static          enabled
alsa-state.service                         static          enabled
alsa-utils.service                         masked          enabled
anacron.service                            enabled         enabled
apache-htcacheclean.service                disabled        enabled
apache-htcacheclean@.service               disabled        enabled
apache2.service                            enabled         enabled
apache2@.service                           disabled        enabled
apparmor.service                           enabled         enabled
apport-autoreport.service                  static          enabled
apport-forward@.service                    static          enabled
apport.service                             generated       enabled
apt-daily-upgrade.service                  static          enabled
apt-daily.service                          static          enabled
autovt@.service                            enabled         enabled
avahi-daemon.service                       enabled         enabled
lines 1-19
----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----</code></pre>
                    </div>
                  </div>
                  <div class="paragraph">
                    <p>Šitaip lengva filtruoti tarnybas pagal vardus (jų šablonus):</p>
                  </div>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ systemctl list-unit-files --type=service --all *Manager*
UNIT FILE                                  STATE   VENDOR PRESET
dbus-org.freedesktop.ModemManager1.service enabled enabled
ModemManager.service                       enabled enabled
NetworkManager-dispatcher.service          enabled enabled
NetworkManager-wait-online.service         enabled enabled
NetworkManager.service                     enabled enabled

5 unit files listed.</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Tarnybų valdymui susirandu įrankį <code>serman2</code>: <a href="https://aur.archlinux.org/packages/serman"
                      class="bare">https://aur.archlinux.org/packages/serman</a></p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>Pasiimu jį iš GitHub:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~$ mkdir src

osboxes@ldvm1:~$ cd src/

osboxes@ldvm1:~$ git clone https://github.com/baoboa/serman
Cloning into 'serman'...
remote: Enumerating objects: 41, done.
remote: Total 41 (delta 0), reused 0 (delta 0), pack-reused 41
Unpacking objects: 100% (41/41), 32.70 KiB | 985.00 KiB/s, done.</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Išsibandau įrankį:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src$ sudo serman/serman.py

----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----
Commands│  Services
────────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────
enable  │  getty@tty2.service                                                                          running ● ▲
restart │  getty@tty6.service                                                                          running ● ▲
start   │  gpu-manager.service                                                                            dead
status  │  graphical.target                                                                               dead
        │  grub-common.service                                                                          exited ●
        │  grub-initrd-fallback.service                                                                   dead
        │  halt.target
        │  hibernate.target
        │  home.mount                                                                                  mounted ●
        │  hwclock.service
        │  hybrid-sleep.target
        │  ifup@.service
        │  ifup@enp0s8.service                                                                          exited ● ▲
        │  ifupdown-pre.service                                                                         exited ●
        │  ifupdown-wait-online.service
────────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────
query service status (display output with F2)                                                  [press F3 for help]</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Deja, įrankis <code>serman2</code> turi trūkumų:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p>Ne visada teisingai nuskaito tarnybų <code>Enabled</code>                                būseną.</p>
                            </li>
                            <li>
                              <p>Taip pat šios būsenos perjungimui (ir kitiems veiksmams)
                                naudoja ne visai intuityvų UI:</p>
                              <div class="ulist">
                                <ul>
                                  <li>
                                    <p>pagalba kviečiama klavišu <code>F3</code>;</p>
                                  </li>
                                  <li>
                                    <p>veiksmo tipas pasirenkamas kairiame stulpelyje,
                                      tarnybos – sąraše dešinėje;</p>
                                  </li>
                                  <li>
                                    <p>tarp jų persijungiama klavišais <code>Right</code>,
                                      <code>Left</code>;</p>
                                  </li>
                                  <li>
                                    <p>tarnybas veiksmui įvykdyti reikia pasirinkti
                                      klavišu <code>Space</code>;</p>
                                  </li>
                                  <li>
                                    <p>veiksmas įvykdomas klavišu <code>Enter</code>;</p>
                                  </li>
                                  <li>
                                    <p>rezultatas pasižiūrimas klavišus <code>F3</code>                                      atskirame vaizde;</p>
                                  </li>
                                  <li>
                                    <p>grįžtama į pradinį vaizdą paspaudus <code>Enter</code>;</p>
                                  </li>
                                  <li>
                                    <p>programa uždaroma paspaudus <code>Ctrl-C</code>;</p>
                                  </li>
                                  <li>
                                    <p>užuominos (angl. <em>Hint</em>) eilutė pradingsta
                                      po pirmojo vaizdo perjungimo ir grįžimo.</p>
                                  </li>
                                </ul>
                              </div>
                            </li>
                            <li>
                              <p>Taip pat įrankis rodo ne tik tarnybų (<code>.service</code>),
                                bet ir kitų SystemD vienetų būsenas:</p>
                              <div class="ulist">
                                <ul>
                                  <li>
                                    <p><code>.automount</code></p>
                                  </li>
                                  <li>
                                    <p><code>.device</code></p>
                                  </li>
                                  <li>
                                    <p><code>.mount</code></p>
                                  </li>
                                  <li>
                                    <p><code>.path</code></p>
                                  </li>
                                  <li>
                                    <p><code>.scope</code></p>
                                  </li>
                                  <li>
                                    <p><code>.slice</code></p>
                                  </li>
                                  <li>
                                    <p><code>.socket</code></p>
                                  </li>
                                  <li>
                                    <p><code>.swap</code></p>
                                  </li>
                                  <li>
                                    <p><code>.target</code></p>
                                  </li>
                                  <li>
                                    <p><code>.timer</code></p>
                                  </li>
                                </ul>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li>
                  <p>Susirandu kitą įrankį, <code>chkservice</code></p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>Diegiu:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~$ apt-cache search chkservice
chkservice - Tool for managing systemd units
osboxes@ldvm1:~$
osboxes@ldvm1:~$ sudo apt-get install chkservice
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  chkservice
0 upgraded, 1 newly installed, 0 to remove and 159 not upgraded.
Need to get 41.3 kB of archives.
After this operation, 188 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 chkservice amd64 0.3-1build1 [41.3 kB]
Fetched 41.3 kB in 1s (58.7 kB/s)
Selecting previously unselected package chkservice.
(Reading database ... 192778 files and directories currently installed.)
Preparing to unpack .../chkservice_0.3-1build1_amd64.deb ...
Unpacking chkservice (0.3-1build1) ...
Setting up chkservice (0.3-1build1) ...
Processing triggers for man-db (2.9.1-1) ...</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Išbandau <code>chkservice</code>:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src$ sudo chkservice

----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----
 Failed: Connection reset by peer

  -m-     kbd.service                                     kbd.service
  [x]  &gt;  kerneloops.service                              Tool to automatically collect and submit kernel crash
  [x]  =  keyboard-setup.service                          Set the console keyboard layout
  [s]  =  kmod-static-nodes.service                       Create list of static device nodes for the current ker
  [s]     kmod.service                                    /lib/systemd/system/kmod.service
  [s]  =  logrotate.service                               Rotate log files
&gt; [x]  =  ModemManager.service                            Modem Manager                                          &lt;
  [s]  =  man-db.service                                  Daily man-db regeneration
  [s]     modprobe@.service                               /lib/systemd/system/modprobe@.service
  [s]  =  modprobe@drm.service                            Load Kernel Module drm
  [s]  =  motd-news.service                               Message of the Day
  [x]  &gt;  mysql.service                                   MySQL Community Server
  [x]     NetworkManager-dispatcher.service               /lib/systemd/system/NetworkManager-dispatcher.service
  [x]  =  NetworkManager-wait-online.service              Network Manager Wait Online
  [x]  &gt;  NetworkManager.service                          Network Manager
  [x]  =  netplan-ovs-cleanup.service                     OpenVSwitch configuration for cleanup

                                                         92/533
----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Norint uždrausti tarnybą ir paspaudus <code>Space</code>,
                          gaunu klaidą <code>Failed: Connection reset by peer</code>.
                          <br> Taip yra dėl klaidos programoje: <a href="https://github.com/linuxenko/chkservice/issues/12"
                            class="bare">https://github.com/linuxenko/chkservice/issues/12</a></p>
                      </li>
                      <li>
                        <p>Imu pataisytą programos kodą iš GitHub: <a href="https://github.com/nufeng1999/chkservice"
                            class="bare">https://github.com/nufeng1999/chkservice</a></p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~$ cd src

osboxes@ldvm1:~/src$ git clone https://github.com/nufeng74/chkservice.git
Cloning into 'chkservice'...
remote: Enumerating objects: 424, done.
remote: Counting objects: 100% (7/7), done.
remote: Compressing objects: 100% (6/6), done.
remote: Total 424 (delta 1), reused 4 (delta 1), pack-reused 417
Receiving objects: 100% (424/424), 98.22 KiB | 1.51 MiB/s, done.
Resolving deltas: 100% (264/264), done.

osboxes@ldvm1:~/src$ cd chkservice
osboxes@ldvm1:~/src/chkservice$ mkdir build
osboxes@ldvm1:~/src/chkservice$ cd build

osboxes@ldvm1:~/src/chkservice/build$ cmake -DCMAKE_INSTALL_PREFIX=/usr ..

Command 'cmake' not found, but can be installed with:

sudo snap install cmake  # version 3.20.5, or
sudo apt  install cmake  # version 3.16.3-1ubuntu1

See 'snap info cmake' for additional versions.</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Diegiu kūrimo priemones:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src/chkservice/build$ sudo apt-get install cmake g++ libsystemd-dev libncurses-dev
Reading package lists... Done
Building dependency tree
Reading state information... Done
Suggested packages:
  cmake-doc ninja-build g++-multilib ncurses-doc
The following NEW packages will be installed:
  cmake g++ libncurses-dev libsystemd-dev
0 upgraded, 4 newly installed, 0 to remove and 153 not upgraded.
Need to get 0 B/4,256 kB of archives.
After this operation, 22.6 MB of additional disk space will be used.
Selecting previously unselected package cmake.
(Reading database ... 196958 files and directories currently installed.)
Preparing to unpack .../cmake_3.16.3-1ubuntu1_amd64.deb ...
Unpacking cmake (3.16.3-1ubuntu1) ...
Selecting previously unselected package g++.
Preparing to unpack .../g++_4%3a9.3.0-1ubuntu2_amd64.deb ...
Unpacking g++ (4:9.3.0-1ubuntu2) ...
Selecting previously unselected package libncurses-dev:amd64.
Preparing to unpack .../libncurses-dev_6.2-0ubuntu2_amd64.deb ...
Unpacking libncurses-dev:amd64 (6.2-0ubuntu2) ...
Selecting previously unselected package libsystemd-dev:amd64.
Preparing to unpack .../libsystemd-dev_245.4-4ubuntu3.7_amd64.deb ...
Unpacking libsystemd-dev:amd64 (245.4-4ubuntu3.7) ...
Setting up libncurses-dev:amd64 (6.2-0ubuntu2) ...
Setting up g++ (4:9.3.0-1ubuntu2) ...
update-alternatives: using /usr/bin/g++ to provide /usr/bin/c++ (c++) in auto mode
Setting up cmake (3.16.3-1ubuntu1) ...
Setting up libsystemd-dev:amd64 (245.4-4ubuntu3.7) ...
Processing triggers for man-db (2.9.1-1) ...</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Kompiliuoju įrankį:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src/chkservice/build$ cmake ..
-- The C compiler identification is GNU 9.3.0
-- The CXX compiler identification is GNU 9.3.0
-- Check for working C compiler: /usr/bin/cc
-- Check for working C compiler: /usr/bin/cc -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/bin/c++
-- Check for working CXX compiler: /usr/bin/c++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- DEBUG mode disabled
-- Local build
-- Found PkgConfig: /usr/bin/pkg-config (found version "0.29.1")
-- Checking for module 'libsystemd'
--   Found libsystemd, version 245
-- Checking for module 'ncurses'
--   Found ncurses, version 6.2.20200212
-- Configuring done
-- Generating done
-- Build files have been written to: /home/osboxes/src/chkservice/build

osboxes@ldvm1:~/src/chkservice/build$ make chkservice
Scanning dependencies of target CHKSYSTEMD
[ 10%] Building CXX object src/CMakeFiles/CHKSYSTEMD.dir/chk-systemd.cpp.o
[ 20%] Building CXX object src/CMakeFiles/CHKSYSTEMD.dir/chk-systemd-utils.cpp.o
[ 30%] Linking CXX static library libCHKSYSTEMD.a
[ 30%] Built target CHKSYSTEMD
[ 40%] Building CXX object src/CMakeFiles/CHKCTL.dir/chk-ctl.cpp.o
[ 50%] Linking CXX static library libCHKCTL.a
[ 50%] Built target CHKCTL
[ 60%] Building CXX object src/CMakeFiles/CHKUI.dir/chk-wmain.cpp.o
  ...
[ 70%] Building CXX object src/CMakeFiles/CHKUI.dir/chk-wutils.cpp.o
[ 80%] Linking CXX static library libCHKUI.a
[ 80%] Built target CHKUI
[ 90%] Building CXX object src/CMakeFiles/chkservice.dir/chkservice.cpp.o
[100%] Linking CXX executable chkservice
[100%] Built target chkservice</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Išbandau pataisymą:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src/chkservice/build$ ll src/chkservice
-rwxrwxr-x 1 osboxes osboxes 94344 Jul  4 15:27 src/chkservice*

osboxes@ldvm1:~/src/chkservice/build$ sudo src/chkservice
----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----


  [x]  &gt;  irqbalance.service                              irqbalance daemon
  -m-     kbd.service                                     kbd.service
  [x]  &gt;  kerneloops.service                              Tool to automatically collect and submit kernel crash
  [x]  =  keyboard-setup.service                          Set the console keyboard layout
  [s]  =  kmod-static-nodes.service                       Create list of static device nodes for the current ker
  [s]     kmod.service                                    /lib/systemd/system/kmod.service
  [s]  =  logrotate.service                               Rotate log files
&gt; [ ]     ModemManager.service                            /lib/systemd/system/ModemManager.service               &lt;
  [s]  =  man-db.service                                  Daily man-db regeneration
  [s]     modprobe@.service                               /lib/systemd/system/modprobe@.service
  [s]  =  modprobe@drm.service                            Load Kernel Module drm
  [s]  =  motd-news.service                               Message of the Day
  [x]  &gt;  mysql.service                                   MySQL Community Server
  [x]     NetworkManager-dispatcher.service               /lib/systemd/system/NetworkManager-dispatcher.service
  [x]  =  NetworkManager-wait-online.service              Network Manager Wait Online
  [x]  &gt;  NetworkManager.service                          Network Manager

                                                         91/532
----8&gt;&lt;----------------------------------------------------------------------------------------------------&gt;&lt;8----</code></pre>
                          </div>
                        </div>
                        <div class="paragraph">
                          <p>Ties <code>ModemManager</code> paspaudus <code>Space</code>,
                            tarnyba dabar išsijungia jau iškart.</p>
                        </div>
                      </li>
                      <li>
                        <p><code>chkservice</code> trūkumai:</p>
                        <div class="ulist">
                          <ul>
                            <li>
                              <p>Nevystomas, autorės apleistas.</p>
                            </li>
                            <li>
                              <p>Nevisai intuityvus TUI (<em>Text User Interface</em>);</p>
                              <div class="ulist">
                                <ul>
                                  <li>
                                    <p>Pagalbos klavišas <code>?</code>;</p>
                                  </li>
                                  <li>
                                    <p>Paieška randa tik pirmą rezultatą;</p>
                                  </li>
                                  <li>
                                    <p>Neaprašytas būsenos stulpelis:</p>
                                    <div class="ulist">
                                      <ul>
                                        <li>
                                          <p><code>=</code> – sustabdyta tarnyba;</p>
                                        </li>
                                        <li>
                                          <p><code>&gt;</code> – veikianti tarnyba.</p>
                                        </li>
                                      </ul>
                                    </div>
                                  </li>
                                </ul>
                              </div>
                            </li>
                          </ul>
                        </div>
                      </li>
                    </ul>
                  </div>
                </li>
                <li>
                  <p>Susirandu dar vieną įrankį, <code>systemctl-ui</code>.</p>
                  <div class="ulist">
                    <ul>
                      <li>
                        <p>Pasiimu jį iš GitHub:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src$ git clone https://github.com/mpbcode/systemctl-ui
Cloning into 'systemctl-ui'...
remote: Enumerating objects: 7, done.
remote: Total 7 (delta 0), reused 0 (delta 0), pack-reused 7
Unpacking objects: 100% (7/7), 14.05 KiB | 1.76 MiB/s, done.</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Diegiu Lua interpretatorių:</p>
                        <div class="listingblock">
                          <div class="content">
                            <pre class="highlight"><code>osboxes@ldvm1:~/src$ sudo apt-get install lua5.3
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  lua5.3
0 upgraded, 1 newly installed, 0 to remove and 153 not upgraded.
Need to get 0 B/110 kB of archives.
After this operation, 414 kB of additional disk space will be used.
Selecting previously unselected package lua5.3.
(Reading database ... 197606 files and directories currently installed.)
Preparing to unpack .../lua5.3_5.3.3-1.1ubuntu2_amd64.deb ...
Unpacking lua5.3 (5.3.3-1.1ubuntu2) ...
Setting up lua5.3 (5.3.3-1.1ubuntu2) ...
update-alternatives: using /usr/bin/lua5.3 to provide /usr/bin/lua (lua-interpreter) in auto mode
update-alternatives: using /usr/bin/luac5.3 to provide /usr/bin/luac (lua-compiler) in auto mode
Processing triggers for man-db (2.9.1-1) ...</code></pre>
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Tikrinu įrankį:</p>
                        <div class="imageblock">
                          <div class="content">
                            <img src="https://user-images.githubusercontent.com/74717106/124387489-9462ef80-dce7-11eb-91be-66d6f26e259d.png"
                              alt="124387489 9462ef80 dce7 11eb 91be 66d6f26e259d">
                          </div>
                        </div>
                      </li>
                      <li>
                        <p>Deja, jis rodo tik uždraustas (<em>Disabled</em>) tarnybas:
                          <br>
                          <a href="https://github.com/mpbcode/systemctl-ui/issues/1" class="bare">https://github.com/mpbcode/systemctl-ui/issues/1</a></p>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_3_tinklo_paslaug_tikrinimas_2">3. Tinklo paslaugų tikrinimas</h4>
            <div class="paragraph">
              <p>Sunkumų neaptikta.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_4_kaimyno_skenavimas_2">4. Kaimyno skenavimas</h4>
            <div class="paragraph">
              <p>Sunkumų neaptikta.</p>
            </div>
            <div class="paragraph">
              <p>Gal tik toks neaiškumas iš 2LD, kuriuose tiksliai kompiuteriuose reikėjo
                diegti žiniatinklio ir DB paslaugas.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_5_paket_persiuntimo_jungimas_2">5. Paketų persiuntimo įjungimas</h4>
            <div class="paragraph">
              <p>Sunkumų neaptikta.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_6_code_iptables_code_patikrinimas_2">6. <code>iptables</code> patikrinimas</h4>
            <div class="paragraph">
              <p>Sunkumų neaptikta.</p>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_7_kompiuterio_apsaugojimas_nuo_resursus_i_naudojan_io_icmp_srauto_2">7. Kompiuterio apsaugojimas nuo resursus išnaudojančio ICMP srauto</h4>
            <div class="paragraph">
              <p>Nustatau apribojimą 1 šalt./s</p>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Deja, virtualaus kompiuterio reakcija į <em>ping</em> srautą nepasikeitė.
                    <br> Įtarimų sukėlė <code>-j ACCEPT</code> ir <code>Chain INPUT (policy ACCEPT)</code>.</p>
                </li>
                <li>
                  <p>Papildau, kad <code>iptables</code> atmestų visus ICMP paketus,
                    neatitikusius šios taisyklės:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ sudo iptables -A INPUT -p icmp -j DROP
osboxes@ldvm1:~$ sudo iptables --list
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
ACCEPT     icmp --  anywhere             anywhere             limit: avg 1/sec burst 1
DROP       icmp --  anywhere             anywhere

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Vėl paleidžiu <em>ping</em> srautą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>[p@localhost Saulius-Krasuckas]$ ping 192.168.10.14
PING 192.168.10.14 (192.168.10.14) 56(84) bytes of data.
64 bytes from 192.168.10.14: icmp_seq=2 ttl=64 time=0.771 ms
64 bytes from 192.168.10.14: icmp_seq=4 ttl=64 time=0.665 ms
64 bytes from 192.168.10.14: icmp_seq=6 ttl=64 time=0.623 ms
64 bytes from 192.168.10.14: icmp_seq=8 ttl=64 time=0.636 ms
^C
--- 192.168.10.14 ping statistics ---
8 packets transmitted, 4 received, 50% packet loss, time 7000ms
rtt min/avg/max/mdev = 0.623/0.673/0.771/0.066 ms</code></pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_8_em_telnet_em_u_draudimas_2">8. <em>Telnet</em> uždraudimas</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Tačiau tai yra užklausų ne uždraudimas, o tik jų registravimas.
                    <br> Uždraudimui reikėtų papildomos taisyklės su <code>-j DROP</code>.</p>
                </li>
                <li>
                  <p>Uždraudžiu <em>Telnet</em> užklausas iš tikrųjų:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ sudo iptables -A INPUT -d 192.168.10.14 -p tcp --dport 23 -j DROP
osboxes@ldvm1:~$ sudo iptables --list
[sudo] password for osboxes:
Chain INPUT (policy ACCEPT)
target     prot opt source               destination
LOG        tcp  --  anywhere             ldvm1                tcp dpt:telnet LOG level warning prefix "TELNET ATTEMPT: "
DROP       tcp  --  anywhere             ldvm1                tcp dpt:telnet

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Kreipiuosi iš kaimyninio kompiuterio į savo virtualųjį:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm2:~$ time telnet 192.168.10.14
Trying 192.168.10.14...
telnet: Unable to connect to remote host: Connection timed out

real    2m9.458s
user    0m0.003s
sys     0m0.008s</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Šįkart užklausa trunka ilgai, ir irgi nesėkminga.</p>
                </li>
                <li>
                  <p>Dabar virtualiojo kompiuterio žurnalas pasipildė net septyniais
                    įrašais apie užklausą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ tail -0f /var/log/syslog
Jul  5 10:13:59 ldvm1 tracker-store[1682]: OK
Jul  5 10:13:59 ldvm1 systemd[997]: tracker-store.service: Succeeded.
Jul  5 10:14:06 ldvm1 kernel: [ 8339.632492] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9577 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:14:07 ldvm1 kernel: [ 8340.609642] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9578 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:14:09 ldvm1 kernel: [ 8342.562629] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9579 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:14:13 ldvm1 kernel: [ 8346.473122] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9580 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:14:21 ldvm1 kernel: [ 8354.294072] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9581 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:14:38 ldvm1 kernel: [ 8369.935750] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9582 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:15:10 ldvm1 kernel: [ 8401.219388] TELNET ATTEMPT: IN=enp0s8 OUT= MAC=08:00:27:40:2c:f6:0a:00:27:00:00:00:08:00 SRC=192.168.10.254 DST=192.168.10.14 LEN=60 TOS=0x10 PREC=0x00 TTL=64 ID=9583 DF PROTO=TCP SPT=52736 DPT=23 WINDOW=29200 RES=0x00 SYN URGP=0
Jul  5 10:17:02 ldvm1 CRON[1816]: (root) CMD (   cd / &amp;&amp; run-parts --report /etc/cron.hourly)</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Tad panašu, kad dabar ji tikrai atmetama (ir todėl kartojama).</p>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_9_automatin_taisykli_keltis_2">9. Automatinė taisyklių keltis</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Patikrinu iptables taisykles – deja, jos neužsikrovė:</p>
                </li>
              </ul>
            </div>
            <div class="listingblock">
              <div class="content">
                <pre class="highlight"><code>osboxes@ldvm1:~$ sudo iptables -L
Chain INPUT (policy ACCEPT)
target     prot opt source               destination

Chain FORWARD (policy ACCEPT)
target     prot opt source               destination

Chain OUTPUT (policy ACCEPT)
target     prot opt source               destination</code></pre>
              </div>
            </div>
            <div class="ulist">
              <ul>
                <li>
                  <p>Iš patirties žinau, kad automatiniam scenarijaus startui reikalinga
                    papildoma simbolinė nuoroda. <br> Ji turi būti <code>/etc/init.d/rc?.d</code>                    direktorijoje, kur <code>?</code> atitinka pageidaujamą <em>Runlevel</em>.</p>
                </li>
                <li>
                  <p>Nustatau dabartinį <em>Runlevel</em>:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ runlevel
N 3</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Patikrinu reikiamą direktoriją:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ ll /etc/rc3.d/
total 16
drwxr-xr-x   2 root root  4096 Jul  3 01:07 ./
drwxr-xr-x 132 root root 12288 Jul  5 12:20 ../
lrwxrwxrwx   1 root root    29 Jun 30 12:08 K01apache-htcacheclean -&gt; ../init.d/apache-htcacheclean*
lrwxrwxrwx   1 root root    27 Mar  7 00:02 K01speech-dispatcher -&gt; ../init.d/speech-dispatcher*
lrwxrwxrwx   1 root root    15 Mar  7 00:02 S01acpid -&gt; ../init.d/acpid*
lrwxrwxrwx   1 root root    17 Mar  7 00:02 S01anacron -&gt; ../init.d/anacron*
lrwxrwxrwx   1 root root    17 Jun 30 12:08 S01apache2 -&gt; ../init.d/apache2*
lrwxrwxrwx   1 root root    16 Mar  7 00:02 S01apport -&gt; ../init.d/apport*
lrwxrwxrwx   1 root root    22 Mar  7 00:02 S01avahi-daemon -&gt; ../init.d/avahi-daemon*
lrwxrwxrwx   1 root root    19 Mar  7 00:02 S01bluetooth -&gt; ../init.d/bluetooth*
lrwxrwxrwx   1 root root    26 Mar  7 00:02 S01console-setup.sh -&gt; ../init.d/console-setup.sh*
lrwxrwxrwx   1 root root    14 Mar  7 00:02 S01cron -&gt; ../init.d/cron*
lrwxrwxrwx   1 root root    14 Mar  7 00:02 S01cups -&gt; ../init.d/cups*
lrwxrwxrwx   1 root root    22 Mar  7 00:02 S01cups-browsed -&gt; ../init.d/cups-browsed*
lrwxrwxrwx   1 root root    14 Mar  7 00:02 S01dbus -&gt; ../init.d/dbus*
lrwxrwxrwx   1 root root    14 Mar  7 00:02 S01gdm3 -&gt; ../init.d/gdm3*
lrwxrwxrwx   1 root root    21 Mar  7 00:02 S01grub-common -&gt; ../init.d/grub-common*
lrwxrwxrwx   1 root root    20 Mar  7 00:02 S01irqbalance -&gt; ../init.d/irqbalance*
lrwxrwxrwx   1 root root    20 Mar  7 00:02 S01kerneloops -&gt; ../init.d/kerneloops*
lrwxrwxrwx   1 root root    15 Jun 30 12:08 S01mysql -&gt; ../init.d/mysql*
lrwxrwxrwx   1 root root    17 Mar  7 00:02 S01openvpn -&gt; ../init.d/openvpn*
lrwxrwxrwx   1 root root    18 Mar  7 00:02 S01plymouth -&gt; ../init.d/plymouth*
lrwxrwxrwx   1 root root    37 Mar  7 00:02 S01pulseaudio-enable-autospawn -&gt; ../init.d/pulseaudio-enable-autospawn*
lrwxrwxrwx   1 root root    15 Mar  7 00:02 S01rsync -&gt; ../init.d/rsync*
lrwxrwxrwx   1 root root    17 Mar  7 00:02 S01rsyslog -&gt; ../init.d/rsyslog*
lrwxrwxrwx   1 root root    15 Mar  7 00:02 S01saned -&gt; ../init.d/saned*
lrwxrwxrwx   1 root root    23 Mar  7 00:02 S01spice-vdagent -&gt; ../init.d/spice-vdagent*
lrwxrwxrwx   1 root root    13 Jun 29 11:37 S01ssh -&gt; ../init.d/ssh*
lrwxrwxrwx   1 root root    29 Mar  7 00:02 S01unattended-upgrades -&gt; ../init.d/unattended-upgrades*
lrwxrwxrwx   1 root root    15 Mar  7 00:02 S01uuidd -&gt; ../init.d/uuidd*
lrwxrwxrwx   1 root root    32 Mar  7 00:15 S01virtualbox-guest-utils -&gt; ../init.d/virtualbox-guest-utils*
lrwxrwxrwx   1 root root    18 Mar  7 00:02 S01whoopsie -&gt; ../init.d/whoopsie*</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Čia kuriu simbolinę nuorodą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ sudo ln -sv /etc/init.d/myfirewall /etc/rc3.d/S99myfirewall
'/etc/rc3.d/S99myfirewall' -&gt; '/etc/init.d/myfirewall'</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Dar sykį perkraunu virtualų kompiuterį:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm1:~$ sudo reboot
Connection to 192.168.10.14 closed by remote host.
Connection to 192.168.10.14 closed.</code></pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
          </div>
          <div class="sect3">
            <h4 id="_10_apsaugoto_kompiuterio_skenavimas_2">10. Apsaugoto kompiuterio skenavimas</h4>
            <div class="ulist">
              <ul>
                <li>
                  <p>Skenuoju kaimyną, bet gaunu klaidą:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm2:~$ sudo nmap -sS -P0 -n -F --max_rtt_timeout 6 192.168.10.14
nmap: unrecognized option '--max_rtt_timeout'
See the output of nmap -h for a summary of options.</code></pre>
                    </div>
                  </div>
                </li>
                <li>
                  <p>Tikrinu <code>nmap</code> versiją:</p>
                  <div class="listingblock">
                    <div class="content">
                      <pre class="highlight"><code>osboxes@ldvm2:~$ nmap --version
Nmap version 7.80 ( https://nmap.org )
Platform: x86_64-pc-linux-gnu
Compiled with: liblua-5.3.3 openssl-1.1.1d nmap-libssh2-1.8.2 libz-1.2.11 libpcre-8.39 libpcap-1.9.1 nmap-libdnet-1.12 ipv6
Compiled without:
Available nsock engines: epoll poll select</code></pre>
                    </div>
                  </div>
                </li>
              </ul>
            </div>
            <div style="page-break-after: always;"></div>
          </div>
        </div>
        <div class="sect2 text-left">
          <h3 id="_pasirinktosios_code_iptables_code_komandos_apra_ymas">Pasirinktosios <code>iptables</code> komandos aprašymas</h3>
          <div class="paragraph">
            <p>Komandą (o tiksliau tris beveik identiškas) pasirinkau iš šių pavyzdžių:
              <br></p>
          </div>
          <div class="paragraph">
            <p><a href="https://www.thegeekstuff.com/2011/06/iptables-rules-examples/#:~:text=11.%20Load%20Balance%20Incoming%20Web%20Traffic"
                class="bare">https://www.thegeekstuff.com/2011/06/iptables-rules-examples/#:~:text=11.%20Load%20Balance%20Incoming%20Web%20Traffic</a></p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code>iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Originaliose komandose yra klaida: <br>
              <br> tūksta nurodytos lentelės <code>nat</code>, nes kitaip komanda
              bando rašyti į <code>filter</code> lentelę, ir joje neranda grandinės
              <code>PREROUTING</code>. <br></p>
          </div>
          <div class="paragraph">
            <p>Taigi, komandas pataisau:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code>iptables -t nat -A PREROUTING -i eth0 &lt;...&gt;
iptables -t nat -A PREROUTING -i eth0 &lt;...&gt;
iptables -t nat -A PREROUTING -i eth0 &lt;...&gt;</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>Ši komanda naudoja nestandartinį <code>iptables</code> modulį <code>state</code>              (angl. <em>Extension module</em>). <br> Jis aprašytas čia:
              <a href="https://www.netfilter.org/documentation/HOWTO/netfilter-extensions-HOWTO-3.html#ss3.9"
                class="bare">https://www.netfilter.org/documentation/HOWTO/netfilter-extensions-HOWTO-3.html#ss3.9</a></p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>Šios komandos papildo <code>nat</code> lentelę.</p>
              </li>
              <li>
                <p>Lentelė naudojama maršrutizavimo sprendimų priėmimui (taisymui).</p>
              </li>
              <li>
                <p>Kiekviena ši komanda:</p>
                <div class="ulist">
                  <ul>
                    <li>
                      <p>tikrina, ar paketas ateina per tinklo sąsają <code>eth0</code>;</p>
                    </li>
                    <li>
                      <p>tikrina, ar jo transportinis protokolas yra TCP;</p>
                    </li>
                    <li>
                      <p>tikrina, ar paskirties prievadas yra HTTPS (443/TCP);</p>
                    </li>
                    <li>
                      <p>įjungia modulį <code>state</code> (angl. <em>Extension module</em>);</p>
                    </li>
                    <li>
                      <p>tikrina, ar tai nauja TCP sesija;</p>
                    </li>
                    <li>
                      <p>įjungia modulį <code>nth</code>;</p>
                    </li>
                    <li>
                      <p>pasirenka skaitiklį #0;</p>
                    </li>
                    <li>
                      <p>nustato skaitiklio #0 talpą = 3;</p>
                    </li>
                    <li>
                      <p>tikrina, ar paketo numeris skaitiklyje yra vienas iš trijų:</p>
                      <div class="ulist">
                        <ul>
                          <li>
                            <p>= 0</p>
                          </li>
                          <li>
                            <p>= 1</p>
                          </li>
                          <li>
                            <p>= 2</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li>
                      <p>ir jei šios sąlygos patenkintos, komanda nurodo tokį paketą
                        nukreipti į vieną iš trijų IP adresų (pagal paketo numerį
                        nurodytame skaitiklyje):</p>
                      <div class="ulist">
                        <ul>
                          <li>
                            <p>192.168.1.101</p>
                          </li>
                          <li>
                            <p>192.168.1.102</p>
                          </li>
                          <li>
                            <p>192.168.1.103</p>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li>
                      <p>&#8230;&#8203; pritaikant paketui atitinkamą <code>Destination NAT</code>                        transliaciją.</p>
                    </li>
                    <li>
                      <p>&#8230;&#8203; ir išlaikant tą patį paskirties prievadą (<em>Destination port</em>)
                        – <code>443/TCP</code>.</p>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Kiekvienos šios komandos tikslas – gaunamą HTTPS srautą po lygiai (paketų
              skaičiaus atžvilgiu) ir iš eilės (angl. <em>Round-robin</em>) išskirstyti
              į tris HTTPS gavėjus. Pvz.:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>žiniatinklio serverius,</p>
              </li>
              <li>
                <p>Proxy serverius,</p>
              </li>
              <li>
                <p>L7 ugniasienes</p>
              </li>
              <li>
                <p>ar kitus su HTTPS apdorojančius tinklo įrenginius.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Kitaip sakant, tikslas – atlikti HTTPS apkrovos paskirstymą (angl. <em>Load balancing</em>)
              tarp trijų tinklo mazgų.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>

</html>