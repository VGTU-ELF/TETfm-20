### Darbo Tikslas

* [ ] Išbandyti Ubuntu Linux elementariąsias tinklo paslaugas.  +
* [ ] Paruošti tarnybinę stotį tolesniems tinklo saugumo tyrimams.

### Trumpas atlikto darbo aprašymas ir atsakymai į klausimus

#### 0. Infrastruktūros paruošimas

##### 1. Ruošimo eiga

Laboratorinei infrastruktūrai paruošti pasirinkau VirtualBox virtualizavimo įrankį (hipervizorių).
Host kompiuteris bus senokas `HP EliteBook 8460p` laptopas:

* CPU: i5-2520M @ 2.50GHz
* RAM: 3692 MiB (prieinami OS)

Host OS bus `CentOS 7.9.2009`.
Pradinę VM konfigūraciją sukuriu savo https://github.com/VGTU-ELF/TETfm-20/blob/main/Semestras-2/1-Informacijos-ir-sistem%C5%B3-apsauga/laboratoriniai-darbai/Saulius-Krasuckas/0LD-infra.sh#L78[_Bash_ skripto] pagalba.

Jis parsisiunčia oficialių `.vdi` failą iš https://sourceforge.net/projects/osboxes/files, sukuria naują VM ir prijungia nurodytą diską.

Tuomet per Bootloader menu įrašau Linux branduolio argumentų eilutėje, kad jis atidarytų konsolę per `ttyS0`, virtualų _Serial/UART_ įrenginį:

```
        linux        <...> console=ttyS0,115200n8
```

Ir galiausiai jungiuosi į _Guest_ konsolę iš _Host_ kompiuterio per `telnet`:
```
telnet 127.0.0.1 23001
```

##### 2. NIC konfigūravimas Host pusėje (NAT + Hostonly)

Panašu, kad su įprasta Virtualbox konfigūracija iš _Host OS_ aš _Guest OS_ nepasieksiu paprastai ir saugiai.  +
Pagal nutylėjimą čia VM sukuriamas `NAT` tipo virtualus tinklo interfeisas:  +
`NIC 1:  ... Attachment: NAT ...`

https://www.virtualbox.org/manual/ch06.html#networkingmodes[VirtualBox dokumentacija]:

> image::https://user-images.githubusercontent.com/74717106/123702651-11b3dd80-d86c-11eb-8254-c297b90459c3.png[]

Todėl VM konfigūracijoje https://github.com/VGTU-ELF/TETfm-20/blob/main/Semestras-2/1-Informacijos-ir-sistem%C5%B3-apsauga/laboratoriniai-darbai/Saulius-Krasuckas/0LD-infra.sh#L78[pridedu papildomą tinklo interfeisą], bet jau `Host-only` tipo:
```
VBoxManage hostonlyif create
VBoxManage list hostonlyifs | awk '/^Name/ {NEWEST_NIC=$2} END {print NEWEST_NIC}' | read HOSTONLY_IF
VBoxManage hostonlyif ipconfig ${HOSTONLY_IF} --ip 192.168.10.8
VBoxManage modifyvm ${VM1} --nic2 hostonly --hostonlyadapter2 ${HOSTONLY_IF}
```
Po šito VM gauna du interfeisus:
```
$ VBoxManage showvminfo VGTU-2021-IiSA-saukrs-LDVM1 | grep NIC.[12]
NIC 1:                       MAC: 080027EB204C, Attachment: NAT, Cable connected: on, Trace: off (file: none), Type: 82540EM, Reported speed: 0 Mbps, Boot priority: 0, Promisc Policy: deny, Bandwidth group: none
NIC 1 Settings:  MTU: 0, Socket (send: 64, receive: 64), TCP Window (send:64, receive: 64)
NIC 2:                       MAC: 080027B6C487, Attachment: Host-only Interface 'vboxnet0', Cable connected: on, Trace: off (file: none), Type: 82540EM, Reported speed: 0 Mbps, Boot priority: 0, Promisc Policy: deny, Bandwidth group: none
```

#### 1. Tinklo sąsajos

Tikrinu:

```
osboxes@osboxes:~$ ifconfig -a
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::3790:7de6:b710:c982  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:c7:5c:f1  txqueuelen 1000  (Ethernet)
        RX packets 263  bytes 241467 (241.4 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 271  bytes 28415 (28.4 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::1c17:744f:d35c:bdf6  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:b2:e7:9d  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 71  bytes 10912 (10.9 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 240  bytes 19632 (19.6 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 240  bytes 19632 (19.6 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```
Tinklo sąsajų (interfeisų) pavadinimai yra `enp0s3`, `enp0s8`, `lo`.  +
Trūko `ifconfig` komandos, teko susiinstaliuoti.

Pasirenkami sąsajų parametrai:

```
osboxes@osboxes:~$ ifconfig --help
Usage:
  ifconfig [-a] [-v] [-s] <interface> [[<AF>] <address>]
  [add <address>[/<prefixlen>]]
  [del <address>[/<prefixlen>]]
  [[-]broadcast [<address>]]  [[-]pointopoint [<address>]]
  [netmask <address>]  [dstaddr <address>]  [tunnel <address>]
  [outfill <NN>] [keepalive <NN>]
  [hw <HW> <address>]  [mtu <NN>]
  [[-]trailers]  [[-]arp]  [[-]allmulti]
  [multicast]  [[-]promisc]
  [mem_start <NN>]  [io_addr <NN>]  [irq <NN>]  [media <type>]
  [txqueuelen <NN>]
  [[-]dynamic]
  [up|down] ...
```

Nustatau tinklo adresą:

```
osboxes@osboxes:~$ ifconfig enp0s8 192.168.10.14 netmask 255.255.255.0
ifconfig enp0s8 192.168.10.14 netmask 255.255.255.0
SIOCSIFADDR: Operation not permitted
SIOCSIFFLAGS: Operation not permitted
SIOCSIFNETMASK: Operation not permitted

osboxes@osboxes:~$ sudo ifconfig enp0s8 192.168.10.14 netmask 255.255.255.0
sudo ifconfig enp0s8 192.168.10.14 netmask 255.255.255.0
[sudo] password for osboxes: 
```

Patikrinu -- adresas tikrai nustatytas:

```
osboxes@osboxes:~$ ifconfig enp0s8
ifconfig enp0s8
enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.14  netmask 255.255.255.0  broadcast 192.168.10.255
        ether 08:00:27:b2:e7:9d  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 308  bytes 47526 (47.5 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```


#### 2. Tinklo vartai

Nustatau vartus:

```
osboxes@osboxes:~$ route add default gw 192.168.10.254
SIOCADDRT: Operation not permitted

osboxes@osboxes:~$ sudo route add default gw 192.168.10.254
```

Patikrinu; vartai nustatyti:

```
osboxes@osboxes:~$ route -n
route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.10.254  0.0.0.0         UG    0      0        0 enp0s8
0.0.0.0         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3
10.0.2.0        0.0.0.0         255.255.255.0   U     100    0        0 enp0s3
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 enp0s3
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
```

#### 3. Statinės konfigūracijos įrašymas

Prieš perkrovimą:

```
osboxes@osboxes:~$ ifconfig -a | grep -e ": " -e inet
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::3790:7de6:b710:c982  prefixlen 64  scopeid 0x20<link>
enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.14  netmask 255.255.255.0  broadcast 192.168.10.255
lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
```

Po pekrovimo:

```
osboxes@osboxes:~$ ifconfig -a | grep -e ": " -e inet
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::3790:7de6:b710:c982  prefixlen 64  scopeid 0x20<link>
enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet6 fe80::1c17:744f:d35c:bdf6  prefixlen 64  scopeid 0x20<link>
lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
```

Surašau statinę konfigūraciją:

```
osboxes@osboxes:~$ sudo -i
root@osboxes:~# 
root@osboxes:~# echo 'iface enp0s8 inet static' >> /etc/network/interfaces
root@osboxes:~# echo 'address 192.168.10.14' >> /etc/network/interfaces
root@osboxes:~# echo 'netmask 255.255.255.0' >> /etc/network/interfaces
root@osboxes:~# echo 'gateway 192.168.10.254' >> /etc/network/interfaces
root@osboxes:~# cat /etc/network/interfaces
iface enp0s8 inet static
address 192.168.10.14
netmask 255.255.255.0
gateway 192.168.10.254
```

Aktyvuoju tinklo konfigūraciją iš failo:

```
root@osboxes:~# ifup enp0s8
root@osboxes:~# logout

osboxes@osboxes:~$ ifconfig enp0s8
enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.14  netmask 255.255.255.0  broadcast 192.168.10.255
        ether 08:00:27:b2:e7:9d  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 343  bytes 48317 (48.3 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

Po perkrovimo tinklas vis tiek nesusikonfigūruoja:

```
osboxes@osboxes:~$ ifconfig enp0s8
enp0s8: flags=4098<BROADCAST,MULTICAST>  mtu 1500
        ether 08:00:27:b2:e7:9d  txqueuelen 1000  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```

Papildau konfigūraciją:

```
root@osboxes:~# cat /etc/network/interfaces
auto enp0s8

iface enp0s8 inet static
address 192.168.10.14
netmask 255.255.255.0
gateway 192.168.10.254
```
Po perkrovimo tinklas jau susikonfigūruoja automatiškai.


#### 4. Kompiuterio vardas

Nustatau kompiuterio vardą:

```
osboxes@osboxes:~$ sudo hostname ldvm1
[sudo] password for osboxes: 
```

Įrašau kompiuterio vardą į konfigūracinį failą:

```
osboxes@osboxes:~$ sudo nano /etc/hostname
osboxes@osboxes:~$ cat /etc/hostname 
ldvm1
```

Patikrinu -- vardas pasikeitė:
```
osboxes@osboxes:~$ hostname
ldvm1
```

Konfigūruoju vardų išsprendimo tarnybines stotis:

```
osboxes@ldvm1:~$ sudo nano /etc/resolv.conf 
[sudo] password for osboxes: 

osboxes@ldvm1:~$ cat /etc/resolv.conf 
nameserver 193.219.146.19
nameserver 193.219.146.2
```

Perkonfigūruoju jas į veikiančias:

```
osboxes@ldvm1:~$ sudo nano /etc/resolv.conf 
sudo: unable to resolve host ldvm1: Temporary failure in name resolution
[sudo] password for osboxes: 

osboxes@ldvm1:~$ cat /etc/resolv.conf 
nameserver 193.219.80.11
nameserver 193.219.80.2
```

#### 5. Standartiniai maršrutai

Nustatau maršrutą per kaimyną:

```
osboxes@ldvm1:~$ sudo route add -net 172.18.14.0 netmask 255.255.255.0 gw 192.168.10.13
osboxes@ldvm1:~$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3
10.0.2.0        0.0.0.0         255.255.255.0   U     100    0        0 enp0s3
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 enp0s8
172.18.14.0     192.168.10.13   255.255.255.0   UG    0      0        0 enp0s8
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
```

Išbandau jį:

```
osboxes@ldvm1:~$ traceroute 172.18.14.1
traceroute to 172.18.14.1 (172.18.14.1), 30 hops max, 60 byte packets
 1  * * *
 2  * * *
 3  * * *
 4  * * *
 5  * * *
 6  *^C
```

#### 6. Vidaus vardai:

Aprašau kaimyninį VM:

```
osboxes@ldvm1:~$ sudo nano /etc/hosts
osboxes@ldvm1:~$ cat /etc/hosts
127.0.0.1   localhost
127.0.1.1   osboxes
192.168.10.14   ldvm1
192.168.10.13   kaimynas
  ...
```

Vardo išsprendimas:

```
osboxes@ldvm1:~$ ping kaimynas
PING kaimynas (192.168.10.13) 56(84) bytes of data.
64 bytes from kaimynas (192.168.10.13): icmp_seq=1 ttl=64 time=0.820 ms
64 bytes from kaimynas (192.168.10.13): icmp_seq=2 ttl=64 time=0.823 ms
^C
--- kaimynas ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
```


#### 7. Keli tinklo adresai

Nustatau antrąjį tinklo adresą:

```
osboxes@ldvm1:~$ ifconfig enp0s8:2 10.10.10.14/24
SIOCSIFADDR: Operation not permitted
SIOCSIFFLAGS: Operation not permitted
SIOCSIFNETMASK: Operation not permitted

osboxes@ldvm1:~$ sudo ifconfig enp0s8:2 10.10.10.14/24
```
```
osboxes@ldvm2:~$ sudo ifconfig enp0s8:2 10.10.10.13/24
```

Patikrinu, nusistatė abiejuose kompiuteriuose:

```
osboxes@ldvm1:~$ ifconfig -a
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::6c28:ce7d:bcd2:2048  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:7e:da:b1  txqueuelen 1000  (Ethernet)
        RX packets 864  bytes 753541 (753.5 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 899  bytes 76163 (76.1 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.14  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::a00:27ff:fe40:2cf6  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:40:2c:f6  txqueuelen 1000  (Ethernet)
        RX packets 34363  bytes 7170684 (7.1 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 35009  bytes 10949048 (10.9 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8:2: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.10.10.14  netmask 255.255.255.0  broadcast 10.10.10.255
        ether 08:00:27:40:2c:f6  txqueuelen 1000  (Ethernet)

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 698  bytes 61712 (61.7 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 698  bytes 61712 (61.7 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```
```
osboxes@ldvm2:~$ ifconfig -a
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::188e:e3e8:fd2f:9d8b  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:32:52:a1  txqueuelen 1000  (Ethernet)
        RX packets 874  bytes 735129 (735.1 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1529  bytes 140649 (140.6 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.13  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::a00:27ff:fe7a:d0b7  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:7a:d0:b7  txqueuelen 1000  (Ethernet)
        RX packets 10683  bytes 1199028 (1.1 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 19407  bytes 6113864 (6.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8:2: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.10.10.13  netmask 255.255.255.0  broadcast 10.10.10.255
        ether 08:00:27:7a:d0:b7  txqueuelen 1000  (Ethernet)

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 890  bytes 75981 (75.9 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 890  bytes 75981 (75.9 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```

Išbandau antrus IP adresus, veikia:

```
osboxes@ldvm1:~$ ping 10.10.10.13
PING 10.10.10.13 (10.10.10.13) 56(84) bytes of data.
64 bytes from 10.10.10.13: icmp_seq=1 ttl=64 time=1.20 ms
64 bytes from 10.10.10.13: icmp_seq=2 ttl=64 time=0.823 ms
64 bytes from 10.10.10.13: icmp_seq=3 ttl=64 time=0.687 ms
^C
--- 10.10.10.13 ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2002ms
rtt min/avg/max/mdev = 0.687/0.902/1.196/0.215 ms
```

#### 8. Programinės įrangos valdymas

Šaltinių sąrašas:

```
osboxes@ldvm1:~$ cat /etc/apt/sources.list
  ...
osboxes@ldvm1:~$ cat /etc/apt/sources.list | grep -v -e ^#

deb http://us.archive.ubuntu.com/ubuntu/ focal main restricted

deb http://us.archive.ubuntu.com/ubuntu/ focal-updates main restricted

deb http://us.archive.ubuntu.com/ubuntu/ focal universe
deb http://us.archive.ubuntu.com/ubuntu/ focal-updates universe

deb http://us.archive.ubuntu.com/ubuntu/ focal multiverse
deb http://us.archive.ubuntu.com/ubuntu/ focal-updates multiverse

deb http://us.archive.ubuntu.com/ubuntu/ focal-backports main restricted universe multiverse


deb http://security.ubuntu.com/ubuntu focal-security main restricted
deb http://security.ubuntu.com/ubuntu focal-security universe
deb http://security.ubuntu.com/ubuntu focal-security multiverse
```

`apt-get` raktai:

```
osboxes@ldvm1:~$ apt-get --help
apt 2.0.4 (amd64)
Usage: apt-get [options] command
       apt-get [options] install|remove pkg1 [pkg2 ...]
       apt-get [options] source pkg1 [pkg2 ...]

apt-get is a command line interface for retrieval of packages
and information about them from authenticated sources and
for installation, upgrade and removal of packages together
with their dependencies.

Most used commands:
  update - Retrieve new lists of packages
  upgrade - Perform an upgrade
  install - Install new packages (pkg is libc6 not libc6.deb)
  reinstall - Reinstall packages (pkg is libc6 not libc6.deb)
  remove - Remove packages
  purge - Remove packages and config files
  autoremove - Remove automatically all unused packages
  dist-upgrade - Distribution upgrade, see apt-get(8)
  dselect-upgrade - Follow dselect selections
  build-dep - Configure build-dependencies for source packages
  satisfy - Satisfy dependency strings
  clean - Erase downloaded archive files
  autoclean - Erase old downloaded archive files
  check - Verify that there are no broken dependencies
  source - Download source archives
  download - Download the binary package into the current directory
  changelog - Download and display the changelog for the given package

See apt-get(8) for more information about the available commands.
Configuration options and syntax is detailed in apt.conf(5).
Information about how to configure sources can be found in sources.list(5).
Package and version choices can be expressed via apt_preferences(5).
Security details are available in apt-secure(8).
                                        This APT has Super Cow Powers.
```

Skaitau `apt-get` aprašymą.
https://web.archive.org/web/20090321133431/https://ubuntu.lt/render/Articles;aid,39[Puslapis] aprašo šias sub-komandas:

```
sudo apt-get update
sudo apt-get upgrade
sudo apt-get dist-upgrade
sudo apt-get install ...
sudo apt-get remove ...
sudo apt-get remove --purge ...
```

Atnaujinu programų sąrašus:

```
osboxes@ldvm1:~$ sudo apt-get update
Hit:1 http://us.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu focal-backports InRelease [101 kB]
Get:5 http://security.ubuntu.com/ubuntu focal-security/main amd64 DEP-11 Metadata [24.5 kB]
Get:6 http://security.ubuntu.com/ubuntu focal-security/universe amd64 DEP-11 Metadata [58.1 kB]
Get:7 http://security.ubuntu.com/ubuntu focal-security/multiverse amd64 DEP-11 Metadata [2,468 B]
Get:8 http://us.archive.ubuntu.com/ubuntu focal-updates/main i386 Packages [500 kB]
Get:9 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [1,081 kB]
Get:10 http://us.archive.ubuntu.com/ubuntu focal-updates/main Translation-en [238 kB]
Get:11 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 DEP-11 Metadata [283 kB]
Get:12 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 c-n-f Metadata [13.6 kB]
Get:13 http://us.archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [318 kB]
Get:14 http://us.archive.ubuntu.com/ubuntu focal-updates/restricted Translation-en [46.1 kB]
Get:15 http://us.archive.ubuntu.com/ubuntu focal-updates/universe i386 Packages [617 kB]
Get:16 http://us.archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [827 kB]
Get:17 http://us.archive.ubuntu.com/ubuntu focal-updates/universe Translation-en [173 kB]
Get:18 http://us.archive.ubuntu.com/ubuntu focal-updates/universe amd64 DEP-11 Metadata [329 kB]
Get:19 http://us.archive.ubuntu.com/ubuntu focal-updates/universe DEP-11 64x64 Icons [364 kB]
Get:20 http://us.archive.ubuntu.com/ubuntu focal-updates/universe amd64 c-n-f Metadata [17.9 kB]
Get:21 http://us.archive.ubuntu.com/ubuntu focal-updates/multiverse Translation-en [6,472 B]
Get:22 http://us.archive.ubuntu.com/ubuntu focal-updates/multiverse amd64 DEP-11 Metadata [2,468 B]
Get:23 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 DEP-11 Metadata [1,780 B]
Fetched 5,231 kB in 12s (435 kB/s)
Reading package lists... Done
```

Instaliuoju `nmap`:

```
osboxes@ldvm1:~$ sudo apt-get install nmap
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  libblas3 liblinear4 lua-lpeg nmap-common
Suggested packages:
  liblinear-tools liblinear-dev ncat ndiff zenmap
The following NEW packages will be installed:
  libblas3 liblinear4 lua-lpeg nmap nmap-common
0 upgraded, 5 newly installed, 0 to remove and 261 not upgraded.
Need to get 5,553 kB of archives.
After this operation, 26.3 MB of additional disk space will be used.
Do you want to continue? [Y/n] y
Get:1 http://us.archive.ubuntu.com/ubuntu focal/main amd64 libblas3 amd64 3.9.0-1build1 [142 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 liblinear4 amd64 2.3.0+dfsg-3build1 [41.7 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 lua-lpeg amd64 1.0.2-1 [31.4 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 nmap-common all 7.80+dfsg1-2build1 [3,676 kB]
Get:5 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 nmap amd64 7.80+dfsg1-2build1 [1,662 kB]
Fetched 5,553 kB in 13s (419 kB/s)
Selecting previously unselected package libblas3:amd64.
(Reading database ... 147980 files and directories currently installed.)
Preparing to unpack .../libblas3_3.9.0-1build1_amd64.deb ...
Unpacking libblas3:amd64 (3.9.0-1build1) ...
Selecting previously unselected package liblinear4:amd64.
Preparing to unpack .../liblinear4_2.3.0+dfsg-3build1_amd64.deb ...
Unpacking liblinear4:amd64 (2.3.0+dfsg-3build1) ...
Selecting previously unselected package lua-lpeg:amd64.
Preparing to unpack .../lua-lpeg_1.0.2-1_amd64.deb ...
Unpacking lua-lpeg:amd64 (1.0.2-1) ...
Selecting previously unselected package nmap-common.
Preparing to unpack .../nmap-common_7.80+dfsg1-2build1_all.deb ...
Unpacking nmap-common (7.80+dfsg1-2build1) ...
Selecting previously unselected package nmap.
Preparing to unpack .../nmap_7.80+dfsg1-2build1_amd64.deb ...
Unpacking nmap (7.80+dfsg1-2build1) ...
Setting up lua-lpeg:amd64 (1.0.2-1) ...
Setting up libblas3:amd64 (3.9.0-1build1) ...
update-alternatives: using /usr/lib/x86_64-linux-gnu/blas/libblas.so.3 to provide /usr/lib/x86_64-linux-gnu/libblas.so.3 (libblas.so.3-x86_64-linux-gnu) in auto mode
Setting up nmap-common (7.80+dfsg1-2build1) ...
Setting up liblinear4:amd64 (2.3.0+dfsg-3build1) ...
Setting up nmap (7.80+dfsg1-2build1) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for libc-bin (2.31-0ubuntu9.2) ...
```

#### 9. Įrankis `nmap`

Susipažįstu su galimybėmis:

```
osboxes@ldvm1:~$ man nmap
osboxes@ldvm1:~$ man nmap | wc -l
troff: <standard input>:2798: warning [p 33, 5.3i]: can't break line
2178
```
(Labai plačios, virš 2000 eilučių aprašymo!)

Skenuoju kaimyną:

```
osboxes@ldvm1:~$ sudo nmap -sS 192.168.10.13
Starting Nmap 7.80 ( https://nmap.org ) at 2021-06-30 03:53 EDT
Nmap scan report for kaimynas (192.168.10.13)
Host is up (0.00062s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh
MAC Address: 08:00:27:7A:D0:B7 (Oracle VirtualBox virtual NIC)

Nmap done: 1 IP address (1 host up) scanned in 0.30 seconds
```

Gautas atsakymas reiškia:

* buvo nuskenuoti 999 TCP transportinio protokolo prievadai;
* kaimyniniame kompiuteryje rastas tik vienas atviras prievadas;
* ten veikia tinklo paslauga SSH;
* kompiuterio MAC adresas priklauso "Oracle VirtualBox" gamintojui.

#### 10. Žiniatinklio paslauga ir klientas

Instaliuoju `links`:

```
osboxes@ldvm1:~$ sudo apt-get install links
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  liblz1
The following NEW packages will be installed:
  liblz1 links
0 upgraded, 2 newly installed, 0 to remove and 261 not upgraded.
Need to get 662 kB of archives.
After this operation, 2,333 kB of additional disk space will be used.
Do you want to continue? [Y/n] Y
Get:1 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 liblz1 amd64 1.11-7 [36.9 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 links amd64 2.20.2-1 [625 kB]
Fetched 662 kB in 2s (351 kB/s)
Selecting previously unselected package liblz1:amd64.
(Reading database ... 148861 files and directories currently installed.)
Preparing to unpack .../liblz1_1.11-7_amd64.deb ...
Unpacking liblz1:amd64 (1.11-7) ...
Selecting previously unselected package links.
Preparing to unpack .../links_2.20.2-1_amd64.deb ...
Unpacking links (2.20.2-1) ...
Setting up liblz1:amd64 (1.11-7) ...
Setting up links (2.20.2-1) ...
Processing triggers for mime-support (3.64ubuntu1) ...
Processing triggers for libc-bin (2.31-0ubuntu9.2) ...
Processing triggers for man-db (2.9.1-1) ...
```


#### X. SSH serverio instaliavimas

Ieškau programinės įrangos paketo:
```
osboxes@osboxes:~$ apt search ssh
Sorting...
Full Text Search...
4pane/focal 6.0-1build1 amd64
  four-pane detailed-list file manager

agent-transfer/focal 0.41-1ubuntu1 amd64
  copy a secret key from GnuPG's gpg-agent to OpenSSH's ssh-agent
  ...
zsnapd-rcmd/focal,focal 0.8.11h-1ubuntu2 all
  Remote sshd command checker for ZFS Snapshot Daemon

zssh/focal 1.5c.debian.1-7build2 amd64
  interactive file transfers over ssh

```

Įdiegiu `OpenSSH` serverį:
```
osboxes@osboxes:~$ sudo apt install openssh-server
sudo apt install openssh-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  ncurses-term openssh-client openssh-sftp-server ssh-import-id
Suggested packages:
  keychain libpam-ssh monkeysphere ssh-askpass molly-guard
The following NEW packages will be installed:
  ncurses-term openssh-server openssh-sftp-server ssh-import-id
The following packages will be upgraded:
  openssh-client
1 upgraded, 4 newly installed, 0 to remove and 261 not upgraded.
Need to get 1,100 kB/1,359 kB of archives.
After this operation, 6,010 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-client amd64 1:8.2p1-4ubuntu0.2 [671 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-sftp-server amd64 1:8.2p1-4ubuntu0.2 [51.5 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-server amd64 1:8.2p1-4ubuntu0.2 [377 kB]
Fetched 1,100 kB in 3s (350 kB/s)       
Preconfiguring packages ...
(Reading database ... 145074 files and directories currently installed.)
  ...
Setting up openssh-sftp-server (1:8.2p1-4ubuntu0.2) ...
Setting up openssh-server (1:8.2p1-4ubuntu0.2) ...

Creating config file /etc/ssh/sshd_config with new version
Creating SSH2 RSA key; this may take some time ...
3072 SHA256:q7is6Llfa0sm7vxlzTgNUUInZNOuRZ5EoRe1VPNEzNg root@osboxes (RSA)
Creating SSH2 ECDSA key; this may take some time ...
256 SHA256:YG+pWX5PORlrH0zmBOcPAxGQOw5cpiE8HMISFrQ6xxA root@osboxes (ECDSA)
Creating SSH2 ED25519 key; this may take some time ...
256 SHA256:SSYtj9I+qp5yLhXGL3AdbncN3lOnSbJ1C4cqQ2UzTkI root@osboxes (ED25519)

Progress: [ 90%] [####################################################......]
Created symlink /etc/systemd/system/sshd.service → /lib/systemd/system/ssh.service.
Created symlink /etc/systemd/system/multi-user.target.wants/ssh.service → /lib/systemd/system/ssh.service.
rescue-ssh.target is a disabled or a static unit, not starting it.
Processing triggers for systemd (245.4-4ubuntu3.4) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for ufw (0.36-6) ...
```

#### Sunkumai

* Programinės įrangos diegimui reikėjo atnaujinti jos duomenų bazę:

`$ sudo apt update`

** Kitaip neįsidiegė bent jau `openssh-server`:

```
osboxes@osboxes:~$ sudo apt install openssh-server
sudo apt install openssh-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  ncurses-term openssh-sftp-server ssh-import-id
Suggested packages:
  molly-guard monkeysphere ssh-askpass
The following NEW packages will be installed:
  ncurses-term openssh-server openssh-sftp-server ssh-import-id
0 upgraded, 4 newly installed, 0 to remove and 58 not upgraded.
Need to get 688 kB of archives.
After this operation, 6,010 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu focal/main amd64 ncurses-term all 6.2-0ubuntu2 [249 kB]
Err:2 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-sftp-server amd64 1:8.2p1-4ubuntu0.1
  404  Not Found [IP: 91.189.91.39 80]
Err:3 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-server amd64 1:8.2p1-4ubuntu0.1
  404  Not Found [IP: 91.189.91.39 80]
Get:4 http://us.archive.ubuntu.com/ubuntu focal/main amd64 ssh-import-id all 5.10-0ubuntu1 [10.0 kB]
Fetched 259 kB in 1s (204 kB/s)           
E: Failed to fetch http://us.archive.ubuntu.com/ubuntu/pool/main/o/openssh/openssh-sftp-server_8.2p1-4ubuntu0.1_amd64.deb  404  Not Found [IP: 91.189.91.39 80]
E: Failed to fetch http://us.archive.ubuntu.com/ubuntu/pool/main/o/openssh/openssh-server_8.2p1-4ubuntu0.1_amd64.deb  404  Not Found [IP: 91.189.91.39 80]
E: Unable to fetch some archives, maybe run apt-get update or try with --fix-missing?
```

** Ataujinu programinės įrangos duomenų bazę:

```
osboxes@osboxes:~$ sudo apt update
sudo apt update
Hit:1 http://us.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
Get:3 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:4 http://us.archive.ubuntu.com/ubuntu focal-backports InRelease [101 kB]
Get:5 http://security.ubuntu.com/ubuntu focal-security/main i386 Packages [254 kB]
  ...
Get:53 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 Packages [4,032 B]
Get:54 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 DEP-11 Metadata [1,780 B]
Get:55 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [224 B]
Fetched 8,419 kB in 14s (588 kB/s)
Reading package lists... Done
Building dependency tree
Reading state information... Done
262 packages can be upgraded. Run 'apt list --upgradable' to see them.
```

* Trūko paketų:

** `$ sudo apt install net-tools`

```
osboxes@osboxes:~$ ifconfig -a

Command 'ifconfig' not found, but can be installed with:

sudo apt install net-tools

osboxes@osboxes:~$ sudo apt install net-tools
[sudo] password for osboxes:
  ...
The following NEW packages will be installed:
  net-tools
  0 upgraded, 1 newly installed, 0 to remove and 58 not upgraded.
  ...
Progress: [ 80%] [##############################################............]
```

** `$ sudo apt install ifupdown`

```
root@osboxes:~# ifup enp0s8

Command 'ifup' not found, but can be installed with:

apt install ifupdown       # version 0.8.35ubuntu1, or
apt install netscript-2.4  # version 5.5.3

root@osboxes:~# apt install ifupdown
Reading package lists... Done
Building dependency tree       
Reading state information... Done
Suggested packages:
  rdnssd
The following NEW packages will be installed:
  ifupdown
0 upgraded, 1 newly installed, 0 to remove and 261 not upgraded.
Need to get 60.5 kB of archives.
After this operation, 234 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu focal/universe amd64 ifupdown amd64 0.8.35ubuntu1 [60.5 kB]
Progress: [ 80%] [##############################################............] 
Fetched 60.5 kB in 1s (84.4 kB/s)   
Selecting previously unselected package ifupdown.
Processing triggers for man-db (2.9.1-1) ...online.target.wants/networking.service → /lib/systemd/system/networking.service.
```

* Komanda `route -a` aprašyme netiksli. Reikėjo `route -n`:

```
osboxes@osboxes:~$ route -a
route -a
route: invalid option -- 'a'
Usage: route [-nNvee] [-FC] [<AF>]           List kernel routing tables
       route [-v] [-FC] {add|del|flush} ...  Modify routing table for AF.

       route {-h|--help} [<AF>]              Detailed usage syntax for specified AF.
       route {-V|--version}                  Display version/author and exit.

        -v, --verbose            be verbose
        -n, --numeric            don't resolve names
        -e, --extend             display other/more information
        -F, --fib                display Forwarding Information Base (default)
        -C, --cache              display routing cache instead of FIB

    ...
```

* Tekstų redaktorius `nano` nesivaldo per VirtualBox _Serial-over-Telnet_ terminalinį prisijungimą:

```
osboxes@osboxes:~$ nano /etc/network/interfaces
(B[ Directory '/etc/network' is not writable ](B  GNU nano 4.8                /etc/network/interfaces                           
(B^G(B^O(B^W(B^K(B^J(B^C(B^X(B^R(B^\(B^U(B^T(B^_(B Go To Line[2A[20A: ^X  ^C^X^Z`^[^[^]^C^C^C
```

** Teko vietoj `nano` naudoti `echo ... >> ...`.

* `vi` pagal nutylėjimą man veikia nekorektiškai:

** Jei atsidarau failą, rodo tvarkingai:

```
root@osboxes:~# vi /etc/network/interfaces
face enp0s8 inet static
address 192.168.10.14
netmask 255.255.255.0
gateway 192.168.10.254
auto enp0s8
~
~
~
```

** Bet jei paspaudžiu <Shift-O> (_Open new line_), tekstas susigadina:

```
[>4;menp0s8 inet static

address 192.168.10.14
netmask 255.255.255.0
gateway 192.168.10.254
auto enp0s8
~
~
```

* Komandinio apvalkalo eilutėje rodomas kompiuterio vardas nepasikeičia savaime.
Tam reikia persijungti iš naujo:

```
osboxes@osboxes:~$ su - osboxes
Password: 
osboxes@ldvm1:~$ 
```

* Sukonfigūravus vardų išsprendimą, jis nustojo veikti:

```
osboxes@ldvm1:~$ sudo nano /etc/resolv.conf 
^Z^H^Hsudo: unable to resolve host ldvm1: Temporary failure in name resolution

osboxes@ldvm1:~$ ping 193.219.80.11
PING 193.219.80.11 (193.219.80.11) 56(84) bytes of data.
From 192.168.10.14 icmp_seq=1 Destination Host Unreachable
From 192.168.10.14 icmp_seq=2 Destination Host Unreachable
^C
--- 193.219.80.11 ping statistics ---
5 packets transmitted, 0 received, +2 errors, 100% packet loss, time 4045ms

```

** Tai įvyko dėl neveikiančiai sukonfigūruotų papildomų tinklo vartų --
jie perima išorei skirto tinklo srauto nukreipimą ir toliau niekur nenukreipia:

```
osboxes@ldvm1:~$ route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.10.254  0.0.0.0         UG    0      0        0 enp0s8
0.0.0.0         10.0.2.2        0.0.0.0         UG    20100  0        0 enp0s3
10.0.2.0        0.0.0.0         255.255.255.0   U     100    0        0 enp0s3
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 enp0s8
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
```

** Veikimui atstatyti iš konfigūracijos pašalinau niekur nevedančius tinklo vartus:

```
osboxes@ldvm1:~$ sudo route delete default gw 192.168.10.254
sudo: unable to resolve host ldvm1: Temporary failure in name resolution
[sudo] password for osboxes: 
```

** Tačiau duotos VU vardų išpsrendimo tarnybinės stotys nepasiekiamios
(ir nebeveikia jau keletą metų):

```
osboxes@ldvm1:~$ ping 193.219.146.19
sboxes@ldvm1:~$ cat /etc/resolv.conf 
nameserver 193.219.146.19
nameserver 193.219.146.2

PING 193.219.146.19 (193.219.146.19) 56(84) bytes of data.
From 193.219.94.140 icmp_seq=1 Destination Host Unreachable
^C

osboxes@ldvm1:~$ ping 193.219.146.2
PING 193.219.146.2 (193.219.146.2) 56(84) bytes of data.
From 193.219.94.140 icmp_seq=1 Destination Host Unreachable
From 193.219.94.140 icmp_seq=3 Destination Host Unreachable
^C
```

** https://www.litnet.lt/images/projektai/Sensorių_pradines_konfiguracijos_instrukcijos.pdf[Susiradau]
atnaujintas VU vardų išsprendimo tarnybines stotis:

```
$ PDF=https://t.co/anBJLWY7f6
$ curl -L $PDF | pdftotext - - | grep -i DNS
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  135k  100  135k    0     0   243k      0 --:--:-- --:--:-- --:--:--  243k
dns1=193.219.80.11
dns2=193.219.80.2
## DNS adresai

osboxes@ldvm1:~$ ping 193.219.80.11
PING 193.219.80.11 (193.219.80.11) 56(84) bytes of data.
64 bytes from 193.219.80.11: icmp_seq=2 ttl=63 time=94.8 ms
64 bytes from 193.219.80.11: icmp_seq=3 ttl=63 time=38.8 ms
^C

osboxes@ldvm1:~$ ping 193.219.80.2
PING 193.219.80.2 (193.219.80.2) 56(84) bytes of data.
64 bytes from 193.219.80.2: icmp_seq=1 ttl=63 time=38.8 ms
64 bytes from 193.219.80.2: icmp_seq=2 ttl=63 time=35.5 ms
^C
```

** Pagaliau gyvieji.

* Nėra komandos `traceroute`:

```
osboxes@ldvm1:~$ traceroute 

Command 'traceroute' not found, but can be installed with:

sudo apt install inetutils-traceroute  # version 2:1.9.4-11, or
sudo apt install traceroute            # version 1:2.1.0-2
```

** Teko įsidiegti:

```
osboxes@ldvm1:~$ sudo apt install traceroute
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  traceroute
0 upgraded, 1 newly installed, 0 to remove and 261 not upgraded.
  ...
update-alternatives: using /usr/sbin/tcptraceroute.db to provide /usr/sbin/tcptraceroute (tcptraceroute) in auto mode
Processing triggers for man-db (2.9.1-1) ...
```

* Deja, nuoroda http://ubuntu.lt/render/Articles;aid,39 neveikia.

** Teko susirasti kopiją Web-archyve: https://web.archive.org/web/20090321133431/https://ubuntu.lt/render/Articles;aid,39


### Duotosios Linux komandos aprašymas: `TODO`

##### Pavyzdys

### Viso darbo išvados

