### Darbo Tikslas

* [ ] Patikrinti tinklo nustatymus.  +
* [ ] Susipažinti su `iptable` sintakse. +
* [ ] Nustatyti paprastą tarpsegmentinį ekraną.

### Trumpas atlikto darbo aprašymas

#### 1. Virtualaus kompiuterio konfigūracija

Tikrinu IP adresus:

```
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
        inet6 fe80::440e:4f39:f7ec:bb91  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:7e:da:b1  txqueuelen 1000  (Ethernet)
        RX packets 32094  bytes 40220614 (40.2 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 15495  bytes 1016242 (1.0 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.14  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::a00:27ff:fe40:2cf6  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:40:2c:f6  txqueuelen 1000  (Ethernet)
        RX packets 51491  bytes 3770623 (3.7 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 78571  bytes 33188421 (33.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 816  bytes 70179 (70.1 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 816  bytes 70179 (70.1 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```

Tikrinu maršrutizacijos lentelę:

```
osboxes@ldvm1:~$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.10.254  0.0.0.0         UG    0      0        0 enp0s8
default         10.0.2.2        0.0.0.0         UG    100    0        0 enp0s3
10.0.2.0        0.0.0.0         255.255.255.0   U     100    0        0 enp0s3
link-local      0.0.0.0         255.255.0.0     U     1000   0        0 enp0s8
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
```

* Nustatymai ne pagal aprašą:

** 1. Vietoj `eth*` tinklo sąsajų vardų Linux naudoja `enp0s*` vardus.  +
   (šiame darbe naudojamas branduolys `5.8.0-59-generic`)  +
   Palieku kaip yra.

** 2. Trūksta `10.10.10.x` adreso (nes LD2 buvo uždėtas rankomis, o po to OS perkrauta).

** 3. OS turi du vartus pagal nutylėjimą:

*** vienas pasiekiamas per `enp0s3`, _NAT_ tipo tinklo sąsają (su automatiniu IP adresu);
*** kitas pasiekiamas per `enp0s8`, _Host-only_ tipo tinklo sąsają.
+
   Atsekiau, kad pirmuosius vartus sukonfigūruoja _NetworkManager_ įrankis,
   sukurdamas dedikuotą tinklo prisijungimą
   (tam atskirą tinklo valdymo abstrakciją):
+
```
osboxes@ldvm1:~$ nmcli connection show
NAME                UUID                                  TYPE      DEVICE
Wired connection 1  2c671148-b52a-4426-9325-d35a52967e3c  ethernet  enp0s3

osboxes@ldvm1:~$ nmcli connection show id "Wired connection 1" | grep 10.0.2.2
IP4.GATEWAY:                            10.0.2.2
IP4.ROUTE[1]:                           dst = 0.0.0.0/0, nh = 10.0.2.2, mt = 100
DHCP4.OPTION[23]:                       routers = 10.0.2.2
```

Pataisau `interfaces` failą ir palyginu su ankstesne versija:

```
osboxes@ldvm1:~$ sudo cp -av /etc/network/interfaces /etc/network/interfaces.BACKUP
'/etc/network/interfaces' -> '/etc/network/interfaces.BACKUP'

osboxes@ldvm1:~$ sudo vim.tiny /etc/network/interfaces

osboxes@ldvm1:~$ diff -u /etc/network/interfaces.BACKUP /etc/network/interfaces
--- /etc/network/interfaces.BACKUP  2021-07-02 15:19:26.453975316 -0400
+++ /etc/network/interfaces 2021-07-02 15:19:30.491993480 -0400
@@ -1,6 +1,11 @@
 auto enp0s8
+auto enp0s8:2
 
 iface enp0s8 inet static
 address 192.168.10.14
 netmask 255.255.255.0
 gateway 192.168.10.254
+
+iface enp0s8:2 inet static
+address 10.10.10.4
```

Aktyvuoju pakeistus nustatymus:

```
osboxes@ldvm1:~$ sudo ifup enp0s8:2

osboxes@ldvm1:~$ ifconfig -a
enp0s3: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        ether 08:00:27:7e:da:b1  txqueuelen 1000  (Ethernet)
        RX packets 32114  bytes 40222382 (40.2 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 15527  bytes 1018963 (1.0 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.10.14  netmask 255.255.255.0  broadcast 192.168.10.255
        inet6 fe80::a00:27ff:fe40:2cf6  prefixlen 64  scopeid 0x20<link>
        ether 08:00:27:40:2c:f6  txqueuelen 1000  (Ethernet)
        RX packets 53197  bytes 3911386 (3.9 MB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 79746  bytes 33383444 (33.3 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

enp0s8:2: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.10.10.4  netmask 255.255.255.0  broadcast 10.10.10.255
        ether 08:00:27:40:2c:f6  txqueuelen 1000  (Ethernet)

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 817  bytes 70252 (70.2 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 817  bytes 70252 (70.2 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

```
Abu IP adresai, prašomi LD3, nurodyti.

* Nereikalingus vartus pagal nutylėjimą bandau išmest būtent per _NetworkManager_
  kartu su minimu abstrakčiu tinklo prisijungimu:
+
```
osboxes@ldvm1:~$ sudo nmcli connection delete "Wired connection 1"
Connection 'Wired connection 1' (2c671148-b52a-4426-9325-d35a52967e3c) successfully deleted.
```

** Tikrinu maršrutizacijos lentelę:
+
```
osboxes@ldvm1:~$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
default         192.168.10.254  0.0.0.0         UG    0      0        0 enp0s8
10.10.10.0      0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
link-local      0.0.0.0         255.255.0.0     U     1000   0        0 enp0s8
192.168.10.0    0.0.0.0         255.255.255.0   U     0      0        0 enp0s8
```
Vieninteliai vartai pagal nutylėjimą yra `192.168.10.254`, kaip ir prašo LD3 aprašas.  +
Patikrinimo žingsnis atliktas.

#### 2. Tinklo paslaugų tikrinimas

Diegiu grafinę priemonę `sysvconfig`:

```
osboxes@ldvm1:~$ sudo apt-get install sysvconfig
Reading package lists... Done
Building dependency tree       
Reading state information... Done
E: Unable to locate package sysvconfig
```

* Programinės įrangos valdymo įrankis neranda minimos priemonės.

** Mėginu atnaujinti programų sąrašus:
+
```
osboxes@ldvm1:~$ sudo apt-get update
0% [Working]
Err:1 http://security.ubuntu.com/ubuntu focal-security InRelease            
  Temporary failure resolving 'security.ubuntu.com'
Err:2 http://us.archive.ubuntu.com/ubuntu focal InRelease                   
  Temporary failure resolving 'us.archive.ubuntu.com'
Err:3 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease
  Temporary failure resolving 'us.archive.ubuntu.com'
Err:4 http://us.archive.ubuntu.com/ubuntu focal-backports InRelease
  Temporary failure resolving 'us.archive.ubuntu.com'
Reading package lists... Done           
W: Failed to fetch http://us.archive.ubuntu.com/ubuntu/dists/focal/InRelease  Temporary failure resolving 'us.archive.ubuntu.com'
W: Failed to fetch http://us.archive.ubuntu.com/ubuntu/dists/focal-updates/InRelease  Temporary failure resolving 'us.archive.ubuntu.com'
W: Failed to fetch http://us.archive.ubuntu.com/ubuntu/dists/focal-backports/InRelease  Temporary failure resolving 'us.archive.ubuntu.com'
W: Failed to fetch http://security.ubuntu.com/ubuntu/dists/focal-security/InRelease  Temporary failure resolving 'security.ubuntu.com'
W: Some index files failed to download. They have been ignored, or old ones used instead.
```

** Paaiškėja, kad pašalinus vartus pagal nutylėjimą `10.0.2.2`, nustojo veikti interneto ryšys.  +
   Jis veikdavo per tinklo sąsają `enp0s3`, kuri VirtualBox sistemoje yra _NAT_ tipo (skirta išėjimui į internetą).  +

** Kadangi dabar ėmė veikti tik vartai per `192.168.10.254` (priklausantys Host OS),
   teko konfigūruoti maršrutizavimą + įjungti _NAT_ mechanizmą jau Host OS pusėje šiai Guest tinklo sąsajai.  +
   (Neaprašau, nes Host OS nebūtinai Linux sistema)

** Sąrašų atnaujinimas vėl veikia:
+
```
osboxes@ldvm1:~$ sudo apt-get update
Hit:1 http://us.archive.ubuntu.com/ubuntu focal InRelease
Get:2 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]
  ...
Get:21 http://us.archive.ubuntu.com/ubuntu focal-backports/universe Translation-en [2,060 B]
Get:22 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 DEP-11 Metadata [1,780 B]
Get:23 http://us.archive.ubuntu.com/ubuntu focal-backports/universe amd64 c-n-f Metadata [288 B]
Fetched 4,078 kB in 10s (391 kB/s)
Reading package lists... Done
```

** Turbūt vertėtų įtraukti tokį patikslinimą į laboratorinio darbo aprašą.  +
   (apie reikiamą _VirtualBox_ tinklo sąsajos tipą + maršrutizavimą tarp Host ir Guest OS)

** Tęsiu `sysvconfig` diegimą.
   Tokio paketo _Ubuntu 20.04.2_ neturi:

```
osboxes@ldvm1:~$ sudo apt-get install sysvconfig
Reading package lists... Done
Building dependency tree       
Reading state information... Done
E: Unable to locate package sysvconfig

osboxes@ldvm1:~$ apt search sysvconfig
Sorting... Done
Full Text Search... Done
```

** Panašu, kad šis įrankis iš Ubuntu pašalintas 2009-09-11:  +
   https://superuser.com/questions/96040/did-sysvconfig-disappear-in-ubuntu-9-10

** Taip pat dabar neveikia ir `systemvconfig` atitikmenys, dar veikę po jo pašalinimo:   +
   `sysv-rc-conf`, `rcconf`:  +
   https://askubuntu.com/questions/1043248/rcconf-package-alternative-in-bionic-beaver

** Panašu, kad jie nebeveikia nuo 2015 m., kai OS atsirado `systemd` mechanizmas.  +
   Ir tai kėlė nepatogumų žmonėms, atnaujinantiems Ubuntu jau net nuo versijos `14.04`:  +
   https://askubuntu.com/questions/1106216/ubuntu-18-04-cant-install-sysv-rc-conf-package-for-managing-startup-services#comment1824791_1106217

** Galbūt reikėtų pagal tai irgi patikslinti LD3 aprašą?


#### X. SSH serverio instaliavimas

Ieškau programinės įrangos paketo:

```
osboxes@osboxes:~$ apt search ssh
Sorting...
Full Text Search...
4pane/focal 6.0-1build1 amd64
  four-pane detailed-list file manager

agent-transfer/focal 0.41-1ubuntu1 amd64
  copy a secret key from GnuPG's gpg-agent to OpenSSH's ssh-agent
  ...
zsnapd-rcmd/focal,focal 0.8.11h-1ubuntu2 all
  Remote sshd command checker for ZFS Snapshot Daemon

zssh/focal 1.5c.debian.1-7build2 amd64
  interactive file transfers over ssh

```

Diegiu `OpenSSH` serverį:

```
osboxes@osboxes:~$ sudo apt install openssh-server
sudo apt install openssh-server
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following additional packages will be installed:
  ncurses-term openssh-client openssh-sftp-server ssh-import-id
Suggested packages:
  keychain libpam-ssh monkeysphere ssh-askpass molly-guard
The following NEW packages will be installed:
  ncurses-term openssh-server openssh-sftp-server ssh-import-id
The following packages will be upgraded:
  openssh-client
1 upgraded, 4 newly installed, 0 to remove and 261 not upgraded.
Need to get 1,100 kB/1,359 kB of archives.
After this operation, 6,010 kB of additional disk space will be used.
Get:1 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-client amd64 1:8.2p1-4ubuntu0.2 [671 kB]
Get:2 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-sftp-server amd64 1:8.2p1-4ubuntu0.2 [51.5 kB]
Get:3 http://us.archive.ubuntu.com/ubuntu focal-updates/main amd64 openssh-server amd64 1:8.2p1-4ubuntu0.2 [377 kB]
Fetched 1,100 kB in 3s (350 kB/s)
Preconfiguring packages ...
(Reading database ... 145074 files and directories currently installed.)
  ...
Setting up openssh-sftp-server (1:8.2p1-4ubuntu0.2) ...
Setting up openssh-server (1:8.2p1-4ubuntu0.2) ...

Creating config file /etc/ssh/sshd_config with new version
Creating SSH2 RSA key; this may take some time ...
3072 SHA256:q7is6Llfa0sm7vxlzTgNUUInZNOuRZ5EoRe1VPNEzNg root@osboxes (RSA)
Creating SSH2 ECDSA key; this may take some time ...
256 SHA256:YG+pWX5PORlrH0zmBOcPAxGQOw5cpiE8HMISFrQ6xxA root@osboxes (ECDSA)
Creating SSH2 ED25519 key; this may take some time ...
256 SHA256:SSYtj9I+qp5yLhXGL3AdbncN3lOnSbJ1C4cqQ2UzTkI root@osboxes (ED25519)

Progress: [ 90%] [####################################################......]
Created symlink /etc/systemd/system/sshd.service → /lib/systemd/system/ssh.service.
Created symlink /etc/systemd/system/multi-user.target.wants/ssh.service → /lib/systemd/system/ssh.service.
rescue-ssh.target is a disabled or a static unit, not starting it.
Processing triggers for systemd (245.4-4ubuntu3.4) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for ufw (0.36-6) ...
```


### Sunkumai ir atsakymai į klausimus


### Duotosios `iptables` komandos aprašymas: `TODO`


##### Pavyzdys


### `iptables` tarsegmentinio ekrano scenarijaus analizė (darbas grupėje)

