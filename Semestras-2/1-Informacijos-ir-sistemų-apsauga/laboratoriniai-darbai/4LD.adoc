Informacijos ir sistemų apsauga

# Laboratorinis darbas #4 +++<br />+++ https://moodle.garsva.lt/mod/assign/view.php?id=297[Atakų atpažinimų sistemos `Snort` tyrimas]


### Užduotis

:SNORT-GUIDE-AWS-URL: https://snort-org-site.s3.amazonaws.com/production/document_files/files/000/003/979/original/Snort3_3.1.0.0_on_Ubuntu_18___20.pdf?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIXACIED2SPMSC7GA%2F20210706%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-Date=20210706T151701Z&X-Amz-Expires=172800&X-Amz-SignedHeaders=host&X-Amz-Signature=84e7cf18a349d0d173ce96592e1fb63bf8a69d86c473de12f01a92ddfe6bb7d1

Instaliuokite Snort IDS: {SNORT-GUIDE-AWS-URL}[Snort3_3.1.0.0_on_Ubuntu_18___20.pdf]

Ataskaitoje aprašykite problemas, su kuriomis susidūrėte, ir jų sprendimą.

(Žemiau – https://moodle.garsva.lt/pluginfile.php/.../mod_assign/introattachment/0/4lab_iptableslaboras8.docx?forcedownload=1[4lab_iptableslaboras8.docx] konspektas, jo tikslų URL praganiau)

---

Anksčiau darbe buvo remiamasi rekomendacijomis iš https://web.archive.org/web/20090126162649/http://snort.org:80/docs/setup_guides/deb-snort-howto.pdf[http://www.snort.org/docs/setup_guides/deb-snort-howto.pdf]  +
(Jos skirtos senesnėms, _Snort 2.4.5_ ir _2.6_ versijoms)

### Tikslas

Parengti ir išbandyti _Snort 3_ atakų atpažinimo sistemą.


### Darbo eiga

[cols=3]
|===


 3+| +++<center>+++ *1. Tinklo paruošimas* +++</center>+++

   | Išvalykite `iptables` nustatymus:
2+a|
```
iptables -F

   | Patikrinkite tinklo nustatymus:
2+a|
```
ifconfig -a
route -n


 3+| +++<center>+++ *2. Snort instaliavimas* +++</center>+++

   | Pereikite į išeities tekstų direktoriją:
2+a|
```
cd /usr/local/src

   | Parsisiųskite Snort:
2+a|
```
wget http://snort.org/dl/current/snort-2.8.1.tar.gz
  
   | Išarchyvuokite:
2+a|
```
tar xvzf snort-2.8.1.tar.gz

   | Pereikite į išarchyvuotą direktoriją:
2+a|
```
cd snort-2.8.1
   
   | Peržiūrėkite instaliavimo rekomendacijas:
2+a|
```
nano doc/INSTALL
   
   | Sukonfigūruokite kompiliatorių:
2+a|
```
./configure --with-mysql --enable-dynamicplugin
   
   | Sukompiliuokite:
2+a|
```
make
   
   | Ir suinstaliuokite:
2+a|
```
make install
   
 3+| +++<center>+++ *3. Konfigūracijos ir žurnalo failai* +++</center>+++

   | Sukurkite direktorijas:
2+a|
```
mkdir /etc/snort
mkdir /var/log/snort

   | Pridėkite grupę:
2+a|
```
groupadd snort

   | ... ir vartotoją:
2+a|
```
useradd -g snort snort

   | Pakeiskite logų direktorijos teises:
2+a|
```
chown snort:snort /var/log/snort

   | Nukopijuokite standartinius konfigūracinius failus:
2+a|
```
cp /usr/local/src/snort-2.8.1/etc/*.* /etc/snort/

   | Nustatykite teises:
2+a|
```
chown snort:snort /etc/snort/snort.conf


 3+| +++<center>+++ *4. Pradinis stebėjimas* +++</center>+++

 3+| Snort tinklo stebėjimo režime stebimos tinklu keliaujančių paketų antraštės arba visi paketai

   | Stebėkite tinklo srautą ir įrašykite duomenis į failus:
2+a|
```
cd /root
snort -v > snort1
   
   | Stebėjimą stabdykite:
2+a|
```
Ctrl-C
   
   | Analizuokite stebėjimo failus.
2+a|
```

 3+| +++<center>+++ *5. Paketų rinkimo režimas* +++</center>+++

 3+| Snort tinklo paketų rinkimo režimas leidžia rinkti tinklo paketus ir saugoti juos dvejetainiuose failuose tolesnei analizei.

   | Startuokite Snort paketų rinkimo režimu:
2+a|
```
snort -dev -l /var/log/snort

   | Gaukite _ping_ užklausas iš kaimyno kompiuterio.
2+a|

   | Sustabdykite paketų rinkimą:
2+a|
```
Ctrl-C

 3+| Gautą informaciją galima nuskaityti įvairiais tinklo stebėjimo įrankiais.

   | Nuskaitykite informaciją apie sustebėtus ICMP paketus:
2+a|
```
snort -dvr /var/log/snort/snort.log.xxxxxx icmp

   | Peržiūrėti informaciją, esančią ekrano viršuje galima:
2+a|
```
Shift+PgUP, Shift+PgDOWN


 3+| +++<center>+++ *6. Snort konfigūravimas* +++</center>+++

 3+| Atakų atpažinimo režimas yra pagrindinis ir turintis daugiausia galimybių.

   | Snort konfigūracija saugoma faile:
2+a|
```
snort.conf

   | Susipažinkite su jo struktūra:
2+a|
```
nano /etc/snort/snort.conf

   | Atkreipkite dėmesį į:
2+a| 

* globalius kintamuosius,
* naudojamus preprocesorius,
* išvedimo įsiepius ir
* naudojamas taisykles

   | Redaguokite konfigūracinį failą:
2+a|
```
nano /etc/snort/snort.conf

   | Jame įrašykite parametrus:
2+a|
```
var RULE_PATH /etc/snort/rules
var HOME_NET 192.168.10.0/24
var EXTERNAT_NET !$HOME_NET

 3+| Naudodami simbolį `#` užkomentuokite visas taisykles išskyrus `local.rules`.

   | Patikrinkite, ar užkomentuotas išvedimas į duomenų bazę:
2+a|
```
output database: log, mysql


|===

### Ataskaitos turinys

#### Darbo Tikslas
#### Trumpas atlikto darbo aptarimas
#### Snort taisyklės analizė:

     (a) alert  tcp any any -> 192.168.1.0/24 111 (content: "|00 01 86 a5|"; msg: "mountd access";)
     (b) alert  tcp any any -> 192.168.1.0/24  80 (content: "cgi-bin/phf"; offset: 3; depth: 22; msg: "CGI-PHF attack";)
     (c) alert      any any -> 192.168.1.0/24 any (flags: SF; msg: "Possible SYN FIN scan";)
     (d) alert  tcp any any -> 192.168.1.0/24  21 (content: "USER root"; msg: "FTP root login";)
     (e) alert  tcp any any -> 192.168.1.0/24  80 (content: "cgi-bin/phf"; flags: PA; msg: "CGI-PHF attack";)
     (f) alert   ip $HOME_NET 5060 –> any any             (msg: "BLEEDING-EDGE VoIP Multiple Unauthorized SIP Responses"; content: "SIP/2.0 401 Unauthorized"; depth 24; threshold: type both, track by_src, count 5, seconds 360; classtype: attempted-dos; sid: 2003194; rev: 2;)"
     (g) alert  tcp $EXTERNAL_NET 6112 -> $HOME_NET any   (msg: "BLEEDING-EDGE GAMES Battle.net failed account login (OLS)\: wrong password"; flow: established, from_server; content: "|FF 3A 08 00 02 00 00 00|"; classtype: policy-violation; sid: 2002115; rev: 1;)
     (h) alert  tcp $HOME_NET any -> $EXTERNAL_NET any    (msg: "BLEEDING-EDGE GAMES Blizzard Downloader"; flow: established, to_server; content: "User-agent\: Blizzard Downloader"; nocase; reference: url,www.worldofwarcraft.com/info/faq/blizzarddownloader.html; classtype: policy-violation; sid: 2002855; rev: 4;)
     (i) alert icmp $EXTERNAL_NET any -> $HOME_NET any    (msg: "ICMP PING NMAP"; dsize: 0; itype: 8; reference: arachnids,162; classtype: attempted-recon; sid: 469; rev 3;)
     (j) alert  udp $EXTERNAL_NET any -> $SQL_SERVERS any (msg: "MS-SQL probe response overflow attempt"; content: "|05|"; depth: 1; byte_test: 2,>,512,1; content: "|3B|"; within: 512; reference: bugtraq,9407; classtype: attempted-user; sid: 2329; rev: 6;)
